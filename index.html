<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>高三恋爱物语：较劲中学6班</title>
    <!-- 引入 Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 确保背景图覆盖整个页面 */
        body {
            font-family: 'Inter', 'Microsoft YaHei', sans-serif;
            background-color: #0d1117; /* 深色背景 */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 0;
            margin: 0;
            user-select: none;
        }

        /* 主容器，限制最大宽度以保持阅读舒适性 */
        #game-container {
            width: 100%;
            max-width: 1280px;
            height: 100vh;
            max-height: 900px; /* 限制最大高度 */
            position: relative;
            background-color: #161b22;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border-radius: 1rem;
        }

        /* 背景图片区域 (使用 CSS 渐变替代图片) */
        #background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: all 0.5s ease-in-out;
            filter: brightness(0.7) blur(1px); /* 略微变暗和模糊，突出前景文字 */
            z-index: 1;
            /* 默认背景 */
            background: linear-gradient(to bottom right, #161b22, #0d1117);
            
            /* 用于显示背景描述文字 */
            display: flex;
            justify-content: center;
            align-items: center;
            color: #d1d5db;
            font-size: 1.5rem;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
        }

        /* 角色立绘区域 */
        #sprites-container {
            position: absolute;
            bottom: 20%; /* 留出底部空间给对话框 */
            width: 100%;
            height: 50%;
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            z-index: 5;
        }

        .sprite {
            font-size: 8rem; /* Emoji作为立绘 */
            line-height: 1;
            padding: 0 1rem;
            opacity: 0;
            transform: translateY(50px) scale(0.9);
            transition: all 0.5s ease-out;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.4));
        }
        .sprite.active {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        
        /* 对话框容器 */
        #dialogue-box {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            min-height: 25%;
            background: rgba(18, 20, 26, 0.9); /* 半透明深色背景 */
            backdrop-filter: blur(5px);
            border-top: 3px solid #4a5568;
            padding: 1.5rem 2rem;
            z-index: 10;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* 角色名字显示 */
        #name-box {
            background-color: #4a5568;
            color: #ffffff;
            padding: 0.25rem 1rem;
            font-weight: bold;
            display: inline-block;
            border-radius: 0.375rem 0.375rem 0 0;
            margin-bottom: -0.25rem; /* 略微覆盖对话框边框 */
            align-self: flex-start;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.2);
        }

        /* 对话文本 */
        #text-content {
            color: #e2e8f0;
            font-size: 1.25rem;
            line-height: 1.8;
            min-height: 3rem;
            margin-top: 0.5rem;
            padding-bottom: 0.5rem;
        }

        /* 选项按钮 */
        #choices-container {
            position: absolute;
            top: 50%; /* 选项居中显示在屏幕中央 */
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 600px;
            padding: 1rem;
            z-index: 20;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .choice-button {
            padding: 1rem 1.5rem;
            background-color: #3b82f6;
            color: white;
            border-radius: 0.75rem;
            font-size: 1.1rem;
            font-weight: 600;
            text-align: left;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 4px #1e40af;
        }

        .choice-button:hover {
            background-color: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 6px #1e40af;
        }

        .choice-button:active {
            transform: translateY(2px);
            box-shadow: 0 2px #1e40af;
        }

        /* 移动端优化 */
        @media (max-width: 768px) {
            #game-container {
                max-height: 100vh;
            }
            .sprite {
                font-size: 6rem;
            }
            #text-content {
                font-size: 1rem;
            }
            #dialogue-box {
                min-height: 35%;
                padding: 1rem;
            }
        }

    </style>
</head>
<body>

<div id="game-container">
    <!-- 背景区域 -->
    <div id="background"></div>

    <!-- 角色立绘区域 -->
    <div id="sprites-container">
        <!-- 左侧立绘 -->
        <div id="sprite-left" class="sprite"></div>
        <!-- 右侧立绘 -->
        <div id="sprite-right" class="sprite"></div>
    </div>

    <!-- 选项区域 (默认隐藏) -->
    <div id="choices-container" class="hidden"></div>

    <!-- 对话框 -->
    <div id="dialogue-box">
        <div id="name-box"></div>
        <div id="text-content">点击开始游戏...</div>
    </div>

    <!-- 调试信息 (可选，方便查看好感度) -->
    <div id="debug-info" class="absolute top-2 left-2 bg-gray-800 text-gray-400 p-2 rounded-lg text-xs z-50 opacity-70">
        <!-- 好感度信息将在此处更新 -->
    </div>
</div>

<script>
    // --- 游戏核心配置 ---
    const GAME_CONFIG = {
        SPRITE_MAP: {
            '钟子程': { default: '🤓', happy: '😄', shy: '😊', embarrassed: '😅', thought: '🤔', love: '🥰' },
            '王子豪': { default: '👑👓', tsundere: '😠', shy: '😳', happy: '😇', confused: '🤨', blush: ' blushing face', sad: '😢' },
            '苏天佑': { default: '🌲👓', quiet: '🤫', thought: '🤔', proud: '🏆', calm: '🙂', sad: '😔', blush: '😳' },
            '李洁': { default: '👩‍🏫👓', strict: '🤨', warm: '😌', love: '💖', blush: '😳', worried: '😥' },
            '范泽宇': { default: '🎮', excited: '🥳', worried: '😨' },
            '黄老师': { default: '📚' },
            '孙老师': { default: '🧪' }
        },
        // FIX: 使用 CSS 渐变和描述文字替代不可靠的外部图片链接
        BACKGROUND_MAP: {
            'classroom': { background: 'linear-gradient(to top right, #374151, #4b5563)', text: '高三6班教室' },
            'hallway': { background: 'linear-gradient(to top, #6b7280, #9ca3af)', text: '课间走廊' },
            'gym': { background: 'linear-gradient(to bottom, #7c3aed, #a78bfa)', text: '体育馆/羽毛球场' },
            'library': { background: 'linear-gradient(to top, #1f2937, #374151)', text: '安静的图书馆' },
            'canteen': { background: 'linear-gradient(to bottom, #fde047, #fcd34d)', text: '学校食堂' },
            'street': { background: 'linear-gradient(to top left, #1f2937, #4b5563)', text: '校门口/夜景' },
            'rooftop': { background: 'linear-gradient(to bottom right, #111827, #374151)', text: '教学楼天台' },
            'park': { background: 'linear-gradient(to top, #10b981, #34d399)', text: '城市公园' },
            'office': { background: 'linear-gradient(to bottom, #d1d5db, #e5e7eb)', text: '教师办公室' },
        }
    };

    // --- 游戏状态变量 ---
    let gameState = {
        scene: 'START',
        index: 0,
        Affection_WZ: 0, // 王子豪好感度
        Affection_ST: 0, // 苏天佑好感度
        Affection_LJ: 0, // 李洁好感度
        isTyping: false,
        textQueue: null,
    };

    // --- DOM 元素引用 ---
    const dialogueBox = document.getElementById('dialogue-box');
    const nameBox = document.getElementById('name-box');
    const textContent = document.getElementById('text-content');
    const background = document.getElementById('background');
    const spriteLeft = document.getElementById('sprite-left');
    const spriteRight = document.getElementById('sprite-right');
    const choicesContainer = document.getElementById('choices-container');
    const debugInfo = document.getElementById('debug-info');

    // --- 故事脚本 (已扩写) ---
    // S: Speaker (说话者)
    // T: Text (台词)
    // B: Background (背景)
    // L: Left Sprite (左侧立绘)
    // R: Right Sprite (右侧立绘)
    // E: Event (特殊事件，如跳转或选项)
    const story = {
        START: [
            { T: "点击对话框或屏幕任意位置开始游戏...", E: 'START_GAME' } 
        ],
        // FIX: Ensure START_GAME leads directly to C1_INTRO
        START_GAME: [ 
            { E: 'C1_INTRO' }
        ],
        // 共通线 - 第一部分：相遇
        C1_INTRO: [
            { B: 'classroom', T: "高三的生活，总是从冗长又紧张的早自习开始，空气中弥漫着习题册的油墨味。", S: '钟子程', L: '钟子程' },
            { T: "我是钟子程，较劲中学高三6班的学生。虽然个子不高，但我对生物的热爱和羽毛球技术，让我在这里找到了自己的位置。", S: '钟子程', L: '钟子程' },
            { T: "门被推开，黄老师领着一个新同学走进来。教室里瞬间安静了。", S: '旁白' },
            { S: '黄老师', T: "同学们，安静一下。这位是新转来的同学，王子豪。是从海外归来的留学生，大家要好好帮助她适应国内的学习环境。", L: '黄老师', R: '王子豪' },
            { S: '王子豪', T: "（鞠躬）…大家好。我是王子豪。请多…指教。", R: '王子豪', L: '黄老师', R_exp: 'default' },
            { S: '钟子程', T: "她看起来有点紧张，说话的中文带着一丝刻板，但长相的确很知性，还戴着一副细框眼镜。难怪大家都在窃窃私语。", S: '钟子程', R: '王子豪', R_exp: 'default', L: '钟子程' },
            { S: '黄老师', T: "王子豪同学，你就坐在...苏天佑旁边的那个空位吧。", L: '黄老师', R: '王子豪' },
            { T: "（王子豪走到座位上，我偷偷瞄了一眼旁边的苏天佑，她正低头看书，没有太多表情。）", S: '旁白', L: null, R: null },
            { B: 'hallway', T: "下课后，我准备去接水，却看到王子豪站在走廊上，似乎在看一本全英文的化学原版书，眼神里带着一丝困惑。", S: '旁白', E: 'CHOICE_1' } 
        ],
        CHOICE_1: {
            T: "（看到王子豪略显困惑，你会怎么做？）",
            Choices: [
                { Text: "上前搭话，询问是否需要帮助翻译书中的内容。", Next: 'C1_A_WZ', Affinity: { Affection_WZ: 5 } },
                { Text: "看到苏天佑从教室出来，过去找她一起打羽毛球。", Next: 'C1_B_ST', Affinity: { Affection_ST: 5 } }
            ]
        },
        C1_A_WZ: [
            { S: '钟子程', T: "那个...王子豪同学，需要帮忙吗？你手上的书，我有点眼熟。", R: '王子豪', L: '钟子程', R_exp: 'default', L_exp: 'default' },
            { S: '王子豪', T: "（皱眉）…不需要。你为什么多管闲事？", R: '王子豪', R_exp: 'tsundere', L_exp: 'shy' },
            { S: '钟子程', T: "我叫钟子程，你手上这本《有机化学基础》是大学教材吧？我认识一个化学很强的同学，如果有专业名词的问题，或许能帮上忙。", L: '钟子程', R_exp: 'tsundere', L_exp: 'happy' },
            { S: '王子豪', T: "（低头，声音变小）哼.我…我只是在适应翻译的刻板…这书的英文比我预想的…更…拗口。", R: '王子豪', R_exp: 'shy', L: '钟子程', L_exp: 'default' },
            { S: '钟子程', T: "没关系，慢慢来。如果你遇到任何中文不适应的地方，也可以随时问我，不用觉得刻板。", L: '钟子程', R_exp: 'shy', L_exp: 'happy' },
            { T: "她抬起头，眼神中闪过一丝感激，但很快又恢复了傲娇的表情。", S: '旁白' },
            { S: '王子豪', T: "（转身）...真是多余的关心。下次别再做这种...狗叫的行为。", R: '王子豪', R_exp: 'tsundere', L: null },
            { S: '钟子程', T: "（狗叫？这形容还真是...独特。不过，我的心跳好像有点不正常。）", S: '钟子程', L: '钟子程', L_exp: 'embarrassed' },
            { T: "放学后，我决定去图书馆借点生物竞赛的书，顺便期待会不会再遇到她。", S: '旁白', E: 'C1_DAY1_AFTERNOON' }
        ],
        C1_B_ST: [
            { S: '钟子程', T: "天佑！等我一下！去打球吗？今天感觉手感来了。", L: '苏天佑', R: '钟子程', L_exp: 'default', R_exp: 'happy' },
            { S: '苏天佑', T: "（抬头，微笑着推了推眼镜）好啊，球拍带了。不过要快点，我还有一套数学竞赛题要刷。", L: '苏天佑', L_exp: 'quiet', R: null, R_exp: null },
            { S: '钟子程', T: "你总是这么拼。对了，新来的王子豪同学，感觉如何？她就坐在你旁边。", R: '苏天佑', L: '钟子程', R_exp: 'quiet', L_exp: 'default' },
            { S: '苏天佑', T: "她…很优秀。我看到她下课时在看英文原版书，应该是化学。她很专注。", R: '苏天佑', R_exp: 'thought', L: null, L_exp: null },
            { S: '钟子程', T: "是啊，我也注意到了。感觉她不太好接近。", R: '钟子程', L: '苏天佑', L_exp: 'calm', R_exp: 'default' },
            { S: '苏天佑', T: "（停顿）…子程，你对她…很感兴趣吗？", L: '苏天佑', L_exp: 'thought', R: '钟子程', R_exp: 'shy' },
            { S: '钟子程', T: "（被天佑的眼神看得有点不自在）哪有！我只是好奇海归学生的生活，你又不是不知道，我的八卦心很强！", R: '钟子程', L: null, R_exp: 'embarrassed' },
            { S: '苏天佑', T: "（轻笑）走吧，去球场。今天我要挑战你。你可别输给老同学。", L: '苏天佑', L_exp: 'calm', R: null },
            { T: "（看着天佑认真的侧脸，她还是和以前一样，总是能注意到别人忽视的细节。我们这种像兄妹一样的关系，让我感到无比舒适。）", S: '钟子程' },
            { T: "放学后，我决定去图书馆借点生物竞赛的书，想着下次再和天佑约球。", S: '旁白', E: 'C1_DAY1_AFTERNOON' }
        ],
        C1_DAY1_AFTERNOON: [
            { B: 'library', T: "图书馆里弥漫着特有的静谧和纸张的味道。高三区域总是坐满了人，我在生物学分区找到了座位。" },
            { S: '钟子程', T: "《细胞的分子生物学》...这本书的深度，比课本难了不止一个数量级。不过，这才是我感兴趣的东西。", L: '钟子程' },
            { T: "突然，我听到隔壁书架传来轻轻的叹气声，一个熟悉的声音用英文小声嘀咕着什么。", S: '旁白' },
            { S: '王子豪', T: "(whispering in English) '...Covalent bond, aromatic stability... this explanation is still too superficial.'", R: '王子豪', R_exp: 'confused', L: '钟子程' },
            { S: '钟子程', T: "（是王子豪！她也在看书。我刚才好像听到了‘共价键’？她在自言自语，我应该…）", S: '钟子程' },
            { E: 'CHOICE_2' }
        ],
        CHOICE_2: {
            T: "（看到王子豪学习的侧脸，你决定怎么做？）",
            Choices: [
                { Text: "借着还书的机会，走过去问她是否需要生物方面的帮助。", Next: 'C1_A_WZ_2', Affinity: { Affection_WZ: 8 } },
                { Text: "给范泽宇发消息，问他最新的游戏进度，顺便八卦新同学的事。", Next: 'C1_B_FZ', Affinity: { Affection_ST: 2 } }, 
                { Text: "继续低头看书，假装没听到。", Next: 'C1_C_NO_ACTION', Affinity: {} }
            ]
        },
        C1_A_WZ_2: [
            { S: '钟子程', T: "（走过去）咳...王子豪同学，你还在看那本化学书吗？", L: '钟子程', R: '王子豪', R_exp: 'default', L_exp: 'default' },
            { S: '王子豪', T: "（猛地合上书，抬起头，眼神锐利）...又是你。你在监视我吗？", R: '王子豪', R_exp: 'tsundere', L_exp: 'shy' },
            { S: '钟子程', T: "不是，我在隔壁。我刚才听到你说英文。你对化学的兴趣很深啊，大学教材都用上了。", R: '王子豪', L_exp: 'happy' },
            { S: '王子豪', T: "这没什么。我是海归…当然要保证学术的前沿性。不像某些人…只满足于高中课本的刻板内容。", R_exp: 'tsundere', L: null },
            { S: '钟子程', T: "（苦笑）好吧，你说得对。不过，我叫钟子程，是生物课代表。虽然是隔壁学科，但如果你对细胞结构、DNA复制这些基础概念有疑问，我倒是可以帮忙。", L: '钟子程', R_exp: 'tsundere' },
            { S: '王子豪', T: "（犹豫了一下）...生物？如果你能确保你的知识不是…狗叫的水平，我或许…可以勉强听一听。", R_exp: 'shy', L: null },
            { S: '钟子程', T: "（成功迈出了一大步！）没问题！期待下次的...学术交流。", L: '钟子程', R_exp: 'shy', L_exp: 'happy' },
            { T: "她没有再赶我走，而是重新打开了书，但这次，她的嘴角似乎不易察觉地向上弯了一下。", S: '旁白', E: 'C1_DAY2_MORNING' }
        ],
        C1_B_FZ: [
            { L: '钟子程', R: '范泽宇', T: "（给范泽宇发消息）宇哥，你在干啥？", S: '钟子程' },
            { S: '范泽宇', T: "（回信息很快）打人机呢！明天周二，下午有羽毛球课！别忘了！新来的校花怎么样？听说特漂亮？", R: '范泽宇', R_exp: 'excited', L: '钟子程' },
            { S: '钟子程', T: "（侧头看了一眼王子豪）是挺漂亮。不过性格有点…傲娇。中文还很刻板，刚才说人多管闲事是‘狗叫’。", L: '钟子程', R: '范泽宇', R_exp: 'excited' },
            { S: '范泽宇', T: "卧槽，极品傲娇啊！子程，你捡到宝了！赶紧刷好感啊！你再不行动，苏天佑就要被我抢走了！哈哈！", R_exp: 'excited', L: null },
            { S: '钟子程', T: "（汗）苏天佑？她才看不上你这游戏宅。对了，羽毛球课的事，天佑也说要练习数学竞赛，你到时候叫她一下。", R: '钟子程', L: '苏天佑', L_exp: 'calm', R_exp: 'default' },
            { S: '范泽宇', T: "放心！羽毛球课是我们班的传统。对了，我听说天佑最近刷题刷得很猛，她那数学水平，快赶上侯老师了！", R: '范泽宇', R_exp: 'default', L: null },
            { S: '钟子程', T: "是啊，她从小就这样。我得抓紧时间再看看生物，不能被她落下太多。", L: '钟子程', R: '范泽宇', R_exp: 'default' },
            { T: "（我收起手机，抬头时，苏天佑刚好从生物区走过来，手里拿着一本高等数学教材。）", S: '旁白' },
            { S: '苏天佑', T: "子程，你看《细胞的分子生物学》？这本书很适合你。你对细胞遗传学的理解总比我快。", R: '苏天佑', R_exp: 'thought', L: '钟子程', L_exp: 'default' },
            { S: '钟子程', T: "天佑！你怎么来了？你也喜欢在图书馆刷题？", L: '钟子程', R: '苏天佑', R_exp: 'thought', L_exp: 'happy' },
            { S: '苏天佑', T: "（淡淡一笑）嗯。明天是李洁老师的生物课，你准备好了吗？", R: '苏天佑', R_exp: 'calm', L: null },
            { T: "与天佑的偶遇让我的心情放松了不少。虽然我们总像兄妹一样，但她是我最信赖的伙伴。", S: '旁白', E: 'C1_DAY2_MORNING' }
        ],
        C1_C_NO_ACTION: [
            { S: '钟子程', T: "（算了，还是别多管闲事了。她一看就是个学霸，我的帮助可能只会让她觉得困扰。）", L: '钟子程', L_exp: 'shy' },
            { T: "我专注于自己的生物书，但注意力总是不由自主地被隔壁的王子豪吸引。她翻页的速度很快，偶尔还会用笔在书上写下工整的英文批注。", S: '旁白' },
            { T: "直到图书馆闭馆铃声响起，她才起身离开，全程没有注意到我。", S: '旁白', E: 'C1_DAY2_MORNING' }
        ],
        C1_DAY2_MORNING: [
            { B: 'classroom', T: "第二天上午，是李洁老师的生物课。她的课总是充满了效率和挑战性。", S: '旁白' },
            { L: '李洁', R: '钟子程', T: "上次提到遗传的分子基础，大家对DNA复制的理解如何？钟子程，你来说说，为什么DNA复制是半保留复制？", S: '李洁', L_exp: 'strict', R_exp: 'default' },
            { S: '钟子程', T: "（站起来）是！因为每个新的DNA分子中，都包含一条来自亲代DNA的母链和一条新合成的子链，这样可以保证遗传信息的稳定性。", R: '钟子程', L: '李洁', L_exp: 'strict', R_exp: 'happy' },
            { S: '李洁', T: "（推了推眼镜，表情缓和）回答得非常完整。不愧是我最看好的生物学苗子。", L: '李洁', L_exp: 'warm', R: '钟子程', R_exp: 'happy', Affinity: { Affection_LJ: 5 } },
            { T: "我感受到了李洁老师眼中一闪而过的欣赏，这让我有点兴奋。", S: '旁白' },
            { T: "这时，角落里的王子豪突然举手了。", S: '旁白' },
            { S: '王子豪', T: "（中文依然刻板）老师，半保留…复制的英文，是…semiconservative replication，对吗？", L: '王子豪', R: '李洁', R_exp: 'warm', L_exp: 'default' },
            { S: '李洁', T: "（看向王子豪，眼神中多了几分审视）是的，王子豪同学。你对专业名词的掌握很准确。看来海外的教育让你很注重基础。", R: '李洁', L: '王子豪', L_exp: 'default', R_exp: 'warm' },
            { S: '钟子程', T: "（她竟然主动举手了，还用英文…感觉她是在展示她的学术水平，不过她是在听我的回答吗？）", S: '钟子程', L: '钟子程', R: '王子豪', R_exp: 'default', L_exp: 'shy' },
            { S: '李洁', T: "好了。今天我们来讨论一下细胞凋亡（Apoptosis）的机制。这是一个生物学前沿课题，也关系到我们接下来的知识竞赛。", L: '李洁', L_exp: 'strict', R: null },
            { T: "李洁老师在黑板上画出了复杂的信号通路图，她讲得非常细致，甚至引用了最新的研究进展。", S: '旁白' },
            { E: 'CHOICE_3' } 
        ],
        CHOICE_3: {
            T: "（李洁老师提到了知识竞赛。你对接下来的课堂重点应该如何反应？）",
            Choices: [
                { Text: "专心致志地记下李洁老师提到的所有专业名词和研究进展。", Next: 'C1_A_LJ', Affinity: { Affection_LJ: 8 } },
                { Text: "偷偷观察王子豪，看她对细胞凋亡的讨论是否有兴趣。", Next: 'C1_B_WZ', Affinity: { Affection_WZ: 5 } },
            ]
        },
        C1_A_LJ: [
            { S: '钟子程', T: "（李洁老师的眼神…她似乎很期待我能更进一步。我不能辜负她的厚望。）我快速在本子上记下“Caspase 级联反应”、“线粒体途径”等关键词。", L: '钟子程', L_exp: 'thought', R: '李洁', R_exp: 'warm' },
            { T: "下课时，我拿着笔记本去请教李洁老师一个细节问题。", S: '旁白' },
            { S: '钟子程', T: "李老师，您刚才提到的Bcl-2蛋白家族对凋亡的调控，是不是意味着它们在细胞膜上的定位决定了细胞的生死开关？", R: '李洁', L: '钟子程', R_exp: 'default', L_exp: 'default' },
            { S: '李洁', T: "（脸上露出赞许的微笑）问得非常好，子程。你总能抓住问题的核心。是的，你可以把线粒体看作细胞凋亡的检察官。", R: '李洁', L: '钟子程', L_exp: 'happy' },
            { T: "她的笑容很温暖，让我感到一阵心安。走出教室，我感觉自己的生物学知识又扎实了一步。", S: '旁白', E: 'C1_DAY2_END' }
        ],
        C1_B_WZ: [
            { S: '钟子程', T: "（细胞凋亡…是很复杂的概念。不知道王子豪能不能理解，毕竟这不是化学。）我偷偷看向她。", R: '王子豪', L: '钟子程', R_exp: 'default', L_exp: 'shy' },
            { T: "王子豪正在全神贯注地听讲，但她时不时会皱紧眉头，似乎对某些概念存在疑问。", S: '旁白' },
            { S: '钟子程', T: "（下课后我走过去）王子豪同学，刚才李洁老师讲的细胞凋亡，你听懂了吗？", R: '王子豪', L: '钟子程', R_exp: 'default', L_exp: 'shy' },
            { S: '王子豪', T: "（眼神闪烁，但很快恢复傲慢）当然。我的英语水平，理解这种学术内容没有任何刻板。只是...我觉得她的通路图，不够简洁。", R: '王子豪', R_exp: 'tsundere', L: null },
            { S: '钟子程', T: "如果有什么不理解的，我们可以一起讨论。比如Caspase酶的激活途径，你可以把它想象成一个逐级放大的信号...", L: '钟子程', R: '王子豪', R_exp: 'tsundere', L_exp: 'default' },
            { S: '王子豪', T: "（打断我）停！不用你来指导。不过…既然你对生物有点钻研…如果你能用英文准确地解释给我听，或许…勉强能接受你的建议。", R: '王子豪', R_exp: 'shy', L: null },
            { T: "虽然嘴上不饶人，但她的眼神却透露着求助。我感觉我离她的距离又近了一点。", S: '旁白', E: 'C1_DAY2_END' }
        ],
        C1_DAY2_END: [
            { B: 'hallway', T: "一周的时间很快过去，较劲中学高三6班的生活，开始围绕着三位特别的女生展开。王子豪的傲娇、苏天佑的文静、李洁老师的严厉，都让我的日常变得不再刻板。", S: '旁白' },
            { S: '范泽宇', T: "（突然从后面拍了我的肩膀）喂！子程！明天周六，去不去网吧！《英雄联盟》新版本更新了！", L: '范泽宇', R: '钟子程', R_exp: 'default', L_exp: 'excited' },
            { S: '钟子程', T: "不了，我得去图书馆，期末考试快到了，我要开始刷生物题了。", R: '钟子程', L: '范泽宇', L_exp: 'excited' },
            { S: '范泽宇', T: "切！不愧是生物课代表。对了，苏天佑说她周末在学校自习室讲数学题，要不要去？人多力量大啊！", L: '范泽宇', L_exp: 'default' },
            { T: "范泽宇的话提醒了我。期末考试即将来临，苏天佑发起的学习会，将是大家共同面对的第一次大考。", S: '旁白' },
            { T: "（好感度总结：王子豪：${Affection_WZ}，苏天佑：${Affection_ST}，李洁：${Affection_LJ}）", S: '旁白' },
            { T: "共通线第一部分暂告一段落。现在我们前往期末学习会。", S: '旁白', E: 'C2_STUDY_SESSION_PREP' }
        ],
        // 共通线 - 第二部分：期末学习会
        C2_STUDY_SESSION_PREP: [
            { B: 'library', T: "周六的下午，阳光透过图书馆自习室的玻璃窗洒进来。虽然是周末，但高三的自习室依旧人满为患。" },
            { T: "我按照范泽宇说的，找到了苏天佑约好的角落。她和范泽宇，还有几个平时玩得比较好的同学已经在那里了。", S: '旁白' },
            { L: '范泽宇', R: '苏天佑', T: "哟，生物课代表终于舍得放下他的DNA，来接受数学的洗礼了？快坐！天佑这儿正讲到一道神仙题！", S: '范泽宇', L_exp: 'happy', R_exp: 'calm' },
            { S: '钟子程', T: "（拉开椅子坐下）抱歉来晚了。天佑，讲到哪儿了？我感觉期末的数学是最大的障碍。", L: '钟子程', R: '苏天佑', L_exp: 'default', R_exp: 'calm' },
            { S: '苏天佑', T: "（将草稿纸推给我）子程，我在讲这道函数大题的解析几何切入点。范泽宇，你那边的极限概念理解了吗？", L: '苏天佑', L_exp: 'thought', R: '范泽宇', R_exp: 'worried' },
            { S: '范泽宇', T: "（挠头）极限？我的极限是把《英雄联盟》打到王者！天佑，你这数学简直是物理超度！能不能，稍微，刻板一点，用我们凡人能懂的方式讲？", R: '范泽宇', L: '苏天佑', L_exp: 'thought', R_exp: 'worried' },
            { S: '苏天佑', T: "（轻笑，那是一种很难得的、发自内心的笑容）好。我尽量把解题思路具象化。子程，你呢？生物方面的压力大吗？", L: '苏天佑', L_exp: 'calm', R: '钟子程', R_exp: 'default' },
            { S: '钟子程', T: "生物还好，主要是化学和英语。哦，说到英语...", R: '钟子程', L_exp: 'calm', R_exp: 'shy' },
            { T: "我刚说到一半，自习室的门又开了。走进来的，正是王子豪。", S: '旁白' },
            { T: "她没有和我们打招呼，只是在离我们稍远的一张桌子旁坐下，拿出那本英文的化学原版书，默默地开始阅读。", S: '旁白', E: 'C2_WZ_ARRIVE' }
        ],
        C2_WZ_ARRIVE: [
            { B: 'library', L: '王子豪', R: '苏天佑', T: "（王子豪坐下后，自习室的气氛似乎变得更加紧张了。她似乎是刻意离我们远一点。）", S: '旁白' },
            { S: '范泽宇', T: "（小声嘀咕）卧槽，校花来了。子程，你上次跟她搭话成功了吗？感觉她比我们班主任还难搞。", L: '范泽宇', L_exp: 'worried', R: '王子豪', R_exp: 'default' },
            { S: '苏天佑', T: "（推了推眼镜）范泽宇，专心。那道题，你现在把解题过程写出来，我来看。子程，别分心。", L: '苏天佑', L_exp: 'thought', R: '范泽宇', R_exp: 'worried' },
            { T: "在苏天佑的威压下，范泽宇乖乖低头写题。但我的注意力还是被王子豪吸引了。", S: '旁白' },
            { S: '钟子程', T: "（我看到她又在用手揉太阳穴，似乎是又遇到了语言障碍。）", S: '钟子程', L: '钟子程', R: '王子豪', R_exp: 'confused' },
            { T: "苏天佑开始讲一道复杂的数学压轴题，她的思路清晰，步骤简洁，连我都听得入迷。", S: '旁白' },
            { S: '苏天佑', T: "…所以，我们通过洛必达法则（L'Hôpital's Rule）的巧妙变形，就可以把这个看似刻板的极限问题，转化为一个非常简洁的几何面积求导…", L: '苏天佑', L_exp: 'proud', R: '钟子程', R_exp: 'default' },
            { S: '钟子程', T: "（内心）不愧是天佑，侯老师都经常夸她。她讲题时的专注和平静，和平时一言不发的她判若两人。", S: '钟子程', L_exp: 'thought' },
            { T: "这时，王子豪的手机屏幕亮了一下，她似乎收到了什么消息，表情变得非常困惑。", S: '旁白', E: 'CHOICE_4' }
        ],
        CHOICE_4: {
            T: "（看到王子豪的神情，你猜她可能遇到了英语或者化学的难题，而苏天佑正在讲数学。你该如何处理？）",
            Choices: [
                { Text: "抓住苏天佑讲题的空档，向她请教一道棘手的生物题。", Next: 'C2_A_ST', Affinity: { Affection_ST: 8, Affection_LJ: 3 } }, 
                { Text: "走到王子豪身边，用英文问她是否遇到了需要翻译或解释的难题。", Next: 'C2_B_WZ', Affinity: { Affection_WZ: 8 } }, 
                { Text: "集中精力听苏天佑讲题，同时思考如何将生物学的知识点融入进来。", Next: 'C2_C_NO_ACTION', Affinity: { Affection_ST: 3 } } 
            ]
        },
        C2_A_ST: [
            { S: '钟子程', T: "（在苏天佑讲完一个步骤后，我立刻插话）天佑，等等！我有一个问题想请教一下你。这跟一道生物题有关。", L: '钟子程', L_exp: 'default', R: '苏天佑', R_exp: 'calm' },
            { S: '苏天佑', T: "（她有些意外地看着我）哦？生物？请说。", R: '苏天佑', L: '钟子程', L_exp: 'default', R_exp: 'thought' },
            { S: '钟子程', T: "这道题是关于种群数量的增长曲线。如果我们用数学模型来描述种群的逻辑斯谛增长（Logistic growth），它的增长率变化过程，在数学上能否找到相似的、能用来求极值的函数？", L: '钟子程', L_exp: 'happy', R: '苏天佑', R_exp: 'calm' },
            { S: '苏天佑', T: "（她的眼睛亮了一下，露出赞许的表情）当然。你的这个问题很有深度。逻辑斯谛曲线是S形增长，其微分方程$\\frac{dN}{dt} = rN (1 - \\frac{N}{K})$…", R: '苏天佑', R_exp: 'proud', L: null },
            { T: "苏天佑开始详细地在草稿纸上演算和解释，她的思维速度让我赞叹。", S: '旁白' },
            { S: '苏天佑', T: "…所以，当种群数量达到$K/2$时，增长率达到最大。这与我们数学上求导后令导数为零找极值的过程是完全一致的。", L: '苏天佑', L_exp: 'proud', R: '钟子程', R_exp: 'happy' },
            { S: '钟子程', T: "原来如此！将生物学问题用数学模型来解决，感觉效率高多了！谢谢你，天佑！", R: '钟子程', L: '苏天佑', L_exp: 'proud', R_exp: 'happy' },
            { T: "（范泽宇在一旁偷偷地翻着他的《英雄联盟》攻略本，而王子豪则投来了好奇的目光，似乎对我和天佑的跨学科交流产生了兴趣。）", S: '旁白', E: 'C2_AFTER_TUTOR' }
        ],
        C2_B_WZ: [
            { S: '钟子程', T: "（我借着去倒水的机会，绕到了王子豪的桌子旁，放低声音）王子豪同学，刚才看你好像遇到麻烦了？是那本化学书上的英语概念吗？", L: '钟子程', L_exp: 'shy', R: '王子豪', R_exp: 'confused' },
            { S: '王子豪', T: "（她抬起头，眼神里带着一丝被看穿的恼怒）关你什么事？你以为你这点…刻板的英文水平，能帮我什么？", R: '王子豪', R_exp: 'tsundere', L: '钟子程', L_exp: 'shy' },
            { S: '钟子程', T: "我看到你手机屏幕上是'Isothermal'的搜索结果，你是在查等温过程的定义吧？这不是纯英文问题，是物理化学的概念。我们班化学最好的孙老师，讲课时也提过这个。", L: '钟子程', L_exp: 'default', R: '王子豪', R_exp: 'tsundere' },
            { S: '王子豪', T: "（傲娇地转过头，但声音小了一点）...哼。那又怎样。我只是觉得这中文翻译，比英文更…刻板。", R: '王子豪', R_exp: 'shy', L: null },
            { S: '钟子程', T: "（我笑了笑）不如这样，我的英语没你好，你来教我一个你觉得最难的英文单词，我来告诉你一个生物的冷知识，怎么样？这是...学术交换。", L: '钟子程', R: '王子豪', R_exp: 'shy', L_exp: 'happy' },
            { S: '王子豪', T: "（犹豫了很久，最终低声道）...好吧。记住，是…勉强接受。你…你现在就可以告诉我你的生物冷知识。", R: '王子豪', R_exp: 'default', L: null },
            { S: '钟子程', T: "（凑近一点）你知道吗？在深海里有一种生物叫'玻璃海绵'，它的骨架是由二氧化硅组成的，而且它的结构…竟然比人类制造的光纤更高效！", L: '钟子程', R: '王子豪', R_exp: 'default', L_exp: 'shy' },
            { S: '王子豪', T: "（她的眼睛里闪烁着好奇的光芒）...光纤？二氧化硅…这很有意思。等温过程的英文是'Isothermal process'，这个单词…你记住了。", R: '王子豪', R_exp: 'thought', L: null },
            { T: "（虽然嘴上不饶人，但她的眼神却透露着求助。我感觉我离她的距离又近了一点。）", S: '钟子程', E: 'C2_AFTER_TUTOR' }
        ],
        C2_C_NO_ACTION: [
            { S: '钟子程', T: "（算了，还是别管她了。现在数学最重要。期末考试的数学要是考砸了，天佑肯定会担心我。）", L: '钟子程', L_exp: 'thought', R: '苏天佑', R_exp: 'proud' },
            { T: "我全神贯注地听着苏天佑讲解的每一步，并努力将自己的思路跟上她严谨的逻辑。数学的天赋虽然不及她，但努力总会有回报。", S: '旁白' },
            { T: "苏天佑注意到我专注的样子，她对我露出了一个淡淡的、鼓励的微笑。", S: '旁白' },
            { S: '苏天佑', T: "子程，你做得很好。这道题的关键步骤你已经掌握了。", R: '苏天佑', L: '钟子程', L_exp: 'happy' },
            { T: "（能得到天佑的肯定，比打赢一场羽毛球比赛还要让我高兴。）", S: '钟子程', E: 'C2_AFTER_TUTOR' }
        ],
        C2_AFTER_TUTOR: [
            { B: 'library', T: "正当我们继续埋头学习时，自习室的门再次被推开。走进来的，竟然是我们的生物老师李洁。", S: '旁白' },
            { L: '李洁', T: "（推了推眼镜，眼神扫过自习室的每一个角落，最终停在了我们的桌子上）看来高三6班的同学们都在努力。范泽宇，不要看手机，知道吗？", S: '李洁', L_exp: 'strict', R: '范泽宇', R_exp: 'worried' },
            { S: '范泽宇', T: "（立刻把手机藏到书下）知道！李老师，我是在查…查一道生物题的资料！", R: '范泽宇', L: '李洁', L_exp: 'strict', R_exp: 'worried' },
            { S: '李洁', T: "（没有理会范泽宇，而是看向我和苏天佑）苏天佑，你的数学是强项，多帮助一下其他同学。钟子程，你呢？生物方面的复习进度怎么样？", L: '李洁', L_exp: 'warm', R: '钟子程', R_exp: 'default' },
            { S: '钟子程', T: "李老师，我正在复习细胞代谢和遗传，并开始尝试一些竞赛级别的习题。", R: '钟子程', L: '李洁', L_exp: 'warm', R_exp: 'happy' },
            { S: '李洁', T: "很好。你的天赋不该只停留在期末考试的层面。记住，保持对生物学最前沿知识的渴望。", L: '李洁', L_exp: 'warm', R: null, Affinity: { Affection_LJ: 5 } },
            { T: "她的话语充满了鼓励，但眼神里又带着一丝复杂的情绪，像是欣赏，又像是…别的什么。", S: '钟子程' },
            { T: "李洁老师走后，自习室又恢复了平静。王子豪默默地整理着她的书本，准备离开了。", S: '旁白', E: 'C2_WZ_LEAVE' }
        ],
        C2_WZ_LEAVE: [
            { B: 'street', L: '王子豪', T: "（我和苏天佑在校门口告别。我看到王子豪独自一人走在前面，夕阳拉长了她的影子。）", S: '旁白' },
            { S: '钟子程', T: "（我想跟她打个招呼，又怕她再次用“狗叫”之类的词语来回敬我。）", S: '钟子程', L: '钟子程', L_exp: 'shy' },
            { S: '王子豪', T: "（她突然停下脚步，转过身，看向我。眼神有点复杂）…钟子程。你…今天的帮助，我不否认…有一点点的用处。", L: '王子豪', L_exp: 'shy', R: '钟子程', R_exp: 'default' },
            { S: '钟子程', T: "（我有些吃惊）啊，那太好了！", R: '钟子程', L: '王子豪', L_exp: 'shy', R_exp: 'happy' },
            { S: '王子豪', T: "（她很快恢复了傲娇）不要…刻板地误会。我只是…在履行学术交换的义务。下次，如果你有任何…英语竞赛的难题，可以勉强…来问我。", L: '王子豪', L_exp: 'tsundere', R: null },
            { S: '钟子程', T: "（她竟然主动提到了英语竞赛！）好！下次见，王子豪同学！", R: '钟子程', L: '王子豪', L_exp: 'tsundere', R_exp: 'happy' },
            { S: '苏天佑', T: "（苏天佑走过来，淡淡地看着王子豪离去的背影）…她果然是个很专注的人。子程，你打算参加英语竞赛吗？", L: '苏天佑', L_exp: 'thought', R: '钟子程', R_exp: 'default' },
            { S: '钟子程', T: "我？我的目标是生物竞赛。不过，如果她需要帮助的话…", R: '钟子程', L: '苏天佑', L_exp: 'thought', R_exp: 'shy' },
            { S: '苏天佑', T: "（她没有继续这个话题）期末考试加油。我们下次再约羽毛球。", L: '苏天佑', L_exp: 'calm', R: null, Affinity: { Affection_ST: 3 } },
            { T: "（期末考试的紧张感，已经被这些复杂的互动冲淡了不少。我知道，我必须要在期末考试中证明自己，才能在较劲中学高三6班，赢得更多的话语权。）", S: '旁白', E: 'C3_BIO_COMPETITION_SETUP' }
        ],
        // 共通线 - 第三部分：生物竞赛组队 (路线分支点)
        C3_BIO_COMPETITION_SETUP: [
            { B: 'classroom', T: "期末考试的成绩很快就下来了。我的生物依旧是全班第一，数学在苏天佑的帮助下也进步明显，化学则差强人意。", S: '钟子程', L: '钟子程' },
            { T: "这天，李洁老师走进教室，手里拿着一张通知单。", S: '旁白' },
            { S: '李洁', T: "同学们，有一个重要的通知。学校将举办高二上学期的生物知识竞赛，这次比赛针对生物学优秀学生，奖励非常丰厚。", L: '李洁', L_exp: 'strict', R: '钟子程', R_exp: 'default' },
            { S: '李洁', T: "最重要的是，竞赛采用双人组队模式，要求**一男一女**组队。钟子程，你作为生物课代表，这次比赛你必须参加。", L: '李洁', L_exp: 'warm', R: '钟子程', R_exp: 'happy' },
            { T: "（李洁老师的目光充满了期待，这让我感到巨大的压力，但同时也感到兴奋。这是我展示自己的最好机会。）", S: '钟子程', L_exp: 'thought' },
            { T: "（但是，我该邀请谁作为我的搭档呢？这是我进入个人线的关键选择！）", S: '旁白', E: 'CHOICE_5_ROUTE_SPLIT' } 
        ],
        CHOICE_5_ROUTE_SPLIT: {
            T: "（生物知识竞赛，一男一女组队。你决定邀请谁作为你的搭档？）",
            Choices: [
                { Text: "邀请对化学和英文有深厚学术基础的王子豪，进行跨学科合作。（王子豪线）", Next: 'C3_CHOOSE_WZ', Affinity: { Affection_WZ: 20 } },
                { Text: "邀请从小到大的青梅竹马苏天佑，寻求她强大逻辑思维的帮助。（苏天佑线）", Next: 'C3_CHOOSE_ST', Affinity: { Affection_ST: 20 } },
                { Text: "向李洁老师提出疑问，询问她是否有合适的人选推荐，并表达自己对她教学水平的崇拜。（李洁线）", Next: 'C3_CHOOSE_LJ', Affinity: { Affection_LJ: 20 } },
            ]
        },
        C3_CHOOSE_WZ: [
            { S: '钟子程', T: "王子豪同学，我想邀请你和我一起参加生物知识竞赛。", R: '王子豪', L: '钟子程' },
            { S: '王子豪', T: "（傲娇地）哼。生物竞赛？我可是化学…算了。既然是你的…刻板请求，我勉强…接受吧。", R_exp: 'tsundere', L: null },
            { T: "（我的心跳加速了。王子豪线 - 开启！）", S: '旁白', E: 'WZ_ROUTE_START' }
        ],
        C3_CHOOSE_ST: [
            { S: '钟子程', T: "天佑，我们一起参加生物知识竞赛吧！我知道你的逻辑思维是最好的。", R: '苏天佑', L: '钟子程' },
            { S: '苏天佑', T: "（文静地）好啊，子程。我们从小到大，一直是最好的搭档。", R_exp: 'calm', L: null },
            { T: "（她平静的眼神里，藏着一丝我看不懂的温柔。苏天佑线 - 开启！）", S: '旁白', E: 'ST_ROUTE_START' }
        ],
        C3_CHOOSE_LJ: [
            { S: '钟子程', T: "李老师，我想问问，您有没有推荐的人选？我个人非常希望能得到您的指导。", R: '李洁', L: '钟子程' },
            { S: '李洁', T: "（眼中闪过一丝喜悦）子程...你总是这么优秀。这次比赛，我亲自来帮助你组织备考。", R_exp: 'warm', L: null },
            { T: "（李洁老师的体贴让我感到温暖。李洁线 - 开启！）", S: '旁白', E: 'LJ_ROUTE_START' }
        ],

        // --- 王子豪线 剧情 ---
        WZ_ROUTE_START: [
            { B: 'classroom', T: "（李洁老师宣布了我的搭档是王子豪，教室里一片哗然。我走到她的座位旁，她正在整理书包，头也没抬。）", S: '旁白' },
            { L: '钟子程', R: '王子豪', T: "王子豪同学，既然我们组队了，那就要认真对待。我会将我的生物学资料全部给你，希望你的化学和英语能帮我弥补知识面的不足。", S: '钟子程', L_exp: 'default', R_exp: 'default' },
            { S: '王子豪', T: "（她把头转过来，眼神中带着一丝不屑，但很快变成了审视）哼。你以为…我的学术水平，是为你这种…刻板的生物学考试服务的吗？", L: '王子豪', L_exp: 'tsundere', R_exp: 'shy' },
            { S: '钟子程', T: "当然不是。我相信你的能力。这次竞赛的主题是细胞的物质运输和能量代谢，需要大量的物理化学知识来分析反应速率和热力学。这正是你的强项。", R: '钟子程', L: '王子豪', L_exp: 'default', R_exp: 'tsundere', Affinity: { Affection_WZ: 5 } },
            { S: '王子豪', T: "（她推了推眼镜，嘴角微微上扬）…算你有点见识。好吧，钟子程。既然你都这么说了。我会勉强…接受你的请求。但你要记住，我只接受最高效率的合作。我们从今晚开始，在图书馆讨论。", L: '王子豪', L_exp: 'thought', R: null },
            { T: "她的眼神里充满了自信和挑战。我知道，这次合作，绝不会像和苏天佑那样轻松。", S: '旁白', E: 'WZ_ROUTE_1_ACADEMIC_CLASH' }
        ],
        WZ_ROUTE_1_ACADEMIC_CLASH: [
            { B: 'library', T: "图书馆的角落，我们面前堆满了生物学、化学和英文文献。王子豪翻阅资料的速度令人震惊。" },
            { L: '王子豪', R: '钟子程', T: "（王子豪指着一份英文论文）子程。这里提到的线粒体ATP合酶的质子梯度，与其说是生物学现象，不如说它是一个典型的电化学势能转换过程。你的解释太…刻板，缺乏物理学的美感。", S: '王子豪', L_exp: 'thought', R_exp: 'thought' },
            { S: '钟子程', T: "我承认我的物理基础不太好，但生物学更关注ATP是如何被合成的，而不是纯粹的能量转换效率。", R: '钟子程', L: '王子豪', L_exp: 'thought', R_exp: 'shy' },
            { S: '王子豪', T: "（她合上论文，直视我）这正是你缺乏的地方。顶尖的生物学，其本质就是物理化学。如果你无法用英语准确地理解原著中‘Proton-Motive Force’的概念，你的生物学理解就永远停留在…高中水平。", L: '王子豪', L_exp: 'strict', R: null, Affinity: { Affection_WZ: 5 } },
            { S: '钟子程', T: "（被她刻薄的言辞激怒了，但又不得不承认她说的有道理）好，我接受你的批评。那请你用最简洁、最不刻板的中文，向我解释一下ATP合酶的能量耦合机制。", R: '钟子程', L: '王子豪', L_exp: 'tsundere', R_exp: 'default' },
            { S: '王子豪', T: "（她沉默了一下，似乎在组织中文）…质子动机力（Proton-Motive Force）是…刻板地来说，是线粒体内外膜之间，氢离子的浓度差和…电位差的叠加。它推动了ATP合酶的…旋转，完成能量耦合。", L: '王子豪', L_exp: 'thought', R: null },
            { T: "她解释得非常清晰，只是在关键的词汇上，依然会使用“刻板”这个词。但那双知性的眼睛里，闪烁着智慧的光芒，让我感到心动。", S: '旁白', E: 'WZ_ROUTE_1_CANTEEN_ENCOUNTER' }
        ],
        WZ_ROUTE_1_CANTEEN_ENCOUNTER: [
            { B: 'canteen', T: "中午，我鼓起勇气邀请王子豪一起去食堂。这是我们第一次在非学术场合一起吃饭。" },
            { L: '王子豪', R: '钟子程', T: "（她看着我的餐盘，皱了皱眉）你点的这个…‘鱼香肉丝’。为什么…刻板的酱汁是甜的？这在我的认知里，是…狗叫一般的错误。", S: '王子豪', L_exp: 'confused', R_exp: 'default' },
            { S: '钟子程', T: "哈哈，鱼香肉丝本来就是酸甜口的，这是我们川菜的特色。别老是刻板、狗叫的！试试这个，麻婆豆腐，这个保证是辣的。", R: '钟子程', L: '王子豪', L_exp: 'confused', R_exp: 'happy' },
            { S: '王子豪', T: "（她用筷子夹了一小块，小心翼翼地尝了一口，眼睛猛地睁大了）…好辣。这…这感觉，像火焰一样。但是…可以接受。这比你的…刻板甜食，要…真实。", L: '王子豪', L_exp: 'shy', R: null, Affinity: { Affection_WZ: 5 } },
            { S: '钟子程', T: "（我笑了）你太可爱了。不用总是那么紧张。我发现，你的中文在谈论美食的时候，会变得流畅很多。", R: '钟子程', L: '王子豪', L_exp: 'shy', R_exp: 'default' },
            { S: '王子豪', T: "（脸颊微红）…胡说。我只是…在履行交流的义务。不要…刻板地理解我的中文水平。", L: '王子豪', L_exp: 'tsundere', R: null },
            { T: "就在这时，李洁老师端着餐盘从旁边经过，她停顿了一下，微笑着看向我们。", S: '旁白' },
            { S: '李洁', T: "两位同学很努力。午饭时间也在讨论学术？王子豪同学，能适应学校的饭菜吗？", L: '李洁', L_exp: 'warm', R: '王子豪', R_exp: 'default' },
            { S: '王子豪', T: "李老师。食物…有点过于…刻板的香料味。但…可以接受。", R: '王子豪', L: '李洁', L_exp: 'tsundere', R_exp: 'warm' },
            { S: '李洁', T: "（李洁老师看向我，眼中带着鼓励）钟子程，你是生物天才。这次竞赛，你的搭档很优秀。记住，要学会去**理解**你搭档的全部，包括她的刻板。", L: '李洁', L_exp: 'thought', R: '钟子程', R_exp: 'default', Affinity: { Affection_LJ: 3 } },
            { T: "李洁老师的话，让我心头一凛。理解她的全部，包括她的傲娇和她的不善表达。这可能就是我的‘最优解’。", S: '旁白', E: 'WZ_ROUTE_1_ENGL_RIVALRY' }
        ],
        WZ_ROUTE_1_ENGL_RIVALRY: [
            { B: 'classroom', T: "几天后，我们在教室里讨论一份生物竞赛的英文资料。这份资料涉及植物的光合作用光反应，充满了复杂的英文专业词汇。" },
            { L: '钟子程', R: '王子豪', T: "（我指着句子）这里提到的‘Photosystem II’的氧化还原电势（Redox potential），如果用中文来理解，就是势能差。但英文的表达，感觉更精确、更…刻板。", S: '钟子程', L_exp: 'thought', R_exp: 'thought' },
            { S: '王子豪', T: "（不屑地轻笑）你真是…刻板。这个词汇，你居然还在用中文来思考。你的英语水平，怎么参加国际学术交流？", L: '王子豪', L_exp: 'tsundere', R_exp: 'shy' },
            { S: '钟子程', T: "我的目标是生物学，又不是英语竞赛。", R: '钟子程', L: '王子豪', L_exp: 'tsundere', R_exp: 'default' },
            { S: '王子豪', T: "（她突然变得严肃）大错特错。如果你打算在顶尖生物学领域深造，英文是你的第二语言，是必不可少的工具。比如光系统II中的锰钙簇（Manganese Cluster），它涉及到水分子裂解的机制，这是纯粹的无机化学过程。如果你不懂’Catalysis’的英文内涵，你如何理解它的催化作用？", L: '王子豪', L_exp: 'strict', R: null, Affinity: { Affection_WZ: 8 } },
            { S: '钟子程', T: "（我被她说得哑口无言。她说的每一个英文单词都带着强烈的学术自信。）那…‘Catalysis’的中文翻译是‘催化作用’，我理解啊。", R: '钟子程', L: '王子豪', L_exp: 'strict', R_exp: 'shy' },
            { S: '王子豪', T: "（叹了口气）中文翻译…是刻板的妥协。英文原著才能领略其美感。这样吧，为了你的学术未来，我勉强…帮你补习英语。但只限于科学文献。", L: '王子豪', L_exp: 'calm', R: '钟子程', R_exp: 'default' },
            { T: "我看着她眼神中的认真，心里涌起一股暖流。她嘴上傲娇，但行动却很诚实。", S: '旁白', E: 'WZ_ROUTE_1_CHOICE_BADMINTON' }
        ],
        WZ_ROUTE_1_CHOICE_BADMINTON: {
            T: "（学习告一段落，你感觉到了压力。你希望通过运动来放松，是时候邀请她走出书本的世界了。）",
            Choices: [
                { Text: "邀请王子豪一起去打羽毛球，让她放下刻板的学术压力。", Next: 'WZ_ROUTE_1_BADMINTON_INVITE', Affinity: { Affection_WZ: 5 } },
                { Text: "邀请她去操场散步，聊聊她在海外的日常生活，以增进了解。", Next: 'WZ_ROUTE_1_TALK_CULTURE', Affinity: { Affection_WZ: 10 } },
                { Text: "算了，自己去跑步，让她继续在图书馆学习。", Next: 'WZ_ROUTE_1_SELF_STUDY', Affinity: {} },
            ]
        },
        WZ_ROUTE_1_BADMINTON_INVITE: [
            { B: 'gym', L: '钟子程', R: '王子豪', T: "（我带着球拍来到她面前）王子豪同学。休息一下吧！体育馆有羽毛球场，我们去打一场？", S: '钟子程', L_exp: 'happy', R_exp: 'default' },
            { S: '王子豪', T: "（皱眉）羽毛球？这种…刻板的体育活动，浪费时间。我的体力，要用在更高效的学习上。", L: '王子豪', L_exp: 'tsundere', R_exp: 'default' },
            { S: '钟子程', T: "不，羽毛球是最好的休息方式，它能让你的思维从刻板的公式中解脱出来。而且，我可是我们班数一数二的高手哦！", R: '钟子程', L: '王子豪', L_exp: 'tsundere', R_exp: 'happy' },
            { S: '王子豪', T: "（她嘴角露出了一个挑衅的弧度）高手？哼。你的自信…太刻板了。好吧，我勉强…接受你的挑战。但我不会输给你的。", L: '王子豪', L_exp: 'thought', R: null },
            { T: "在球场上，王子豪虽然步伐有些生硬，但她的身体协调性非常好。她打出的每一个球，都精准地落在了我防守的角落，如同她精确的计算。", S: '旁白' },
            { S: '钟子程', T: "（气喘吁吁）哇…你的预判能力太强了！你是怎么做到的？", L: '钟子程', R: '王子豪', L_exp: 'shy', R_exp: 'calm' },
            { S: '王子豪', T: "（轻轻擦汗）很简单。你的击球习惯…太刻板了。我只需要分析你的身体倾斜角度和肌肉发力方向，就能计算出…球的最佳落点。", L: '王子豪', L_exp: 'proud', R: null },
            { T: "虽然她赢了比赛，但脸上难得露出了一丝纯粹的，而非傲娇的笑容。那一刻，我感觉我们之间的距离又拉近了一步。", S: '旁白', E: 'WZ_ROUTE_1_VAGUE_FUTURE' }
        ],
        WZ_ROUTE_1_TALK_CULTURE: [
            { B: 'rooftop', T: "（我们坐在教学楼的天台上，俯瞰着校园。夕阳洒在她的侧脸上，显得柔和许多。）", S: '旁白' },
            { S: '钟子程', T: "在海外生活，应该很有趣吧？有没有什么让你觉得很震撼的经历？", S: '钟子程', L_exp: 'default', R_exp: 'default' },
            { S: '王子豪', T: "（她沉默了一会儿，语气有些低落）那里…很自由。但在学术上，竞争也更…刻板。每个人都只专注于自己的领域，人际关系很简单。", L: '王子豪', L_exp: 'shy', R: '钟子程', R_exp: 'default' },
            { S: '钟子程', T: "那你…为什么会选择回来较劲中学？这里的氛围，跟国外很不一样吧？", R: '钟子程', L: '王子豪', L_exp: 'shy', R_exp: 'thought' },
            { S: '王子豪', T: "（她突然转头看向我，眼神复杂）…因为…我需要完成一些…刻板的约定。在我的计划里，高中毕业后，我会回到海外…去读大学，并在化学领域继续深造。", L: '王子豪', L_exp: 'sad', R: null, Affinity: { Affection_WZ: 5 } },
            { T: "（她的目光中，带着一丝坚定，也带着一丝无奈。‘高中毕业后，回到海外’…这句话像一块石头，沉甸甸地压在了我的心上。）", S: '旁白', E: 'WZ_ROUTE_1_VAGUE_FUTURE' }
        ],
        WZ_ROUTE_1_SELF_STUDY: [
            { B: 'library', T: "我决定自己去操场跑步，将时间留给她。她似乎没有察觉我的离开，依旧沉浸在她的学术世界中。" },
            { T: "（跑步回来后，我看到王子豪已经离开了，桌上只留下一张字条：'生物学资料的催化反应部分，我已经用英文整理了一份更清晰的思路。不要再做那些…刻板的运动了。WZ.'）", S: '旁白' },
            { T: "虽然她依然傲娇，但这份小小的帮助，让我感受到了她独特的温柔。", S: '旁白', E: 'WZ_ROUTE_1_VAGUE_FUTURE' }
        ],
        WZ_ROUTE_1_VAGUE_FUTURE: [
            { B: 'street', T: "（我和王子豪一起走出校门，夕阳拉长了我们的身影。空气中弥漫着即将分离的淡淡愁绪。）", S: '旁白' },
            { L: '王子豪', R: '钟子程', T: "钟子程。接下来的几天，我们必须全力准备生物竞赛。我不允许我的队友，表现出…刻板的失误。", S: '王子豪', L_exp: 'tsundere', R_exp: 'default' },
            { S: '钟子程', T: "放心吧，我不会辜负你的期望。但…关于你毕业后要出国的事情…是真的吗？", R: '钟子程', L: '王子豪', L_exp: 'tsundere', R_exp: 'shy' },
            { S: '王子豪', T: "（她的眼神闪烁了一下，很快恢复了冷漠）这是…刻板的个人规划。与你无关。你只需要专注于眼前的竞赛即可。不要…多管闲事。", L: '王子豪', L_exp: 'shy', R: null, Affinity: { Affection_WZ: 3 } },
            { T: "（虽然她拒绝回答，但那份刻意的回避，让我知道她的未来，是横亘在我们面前的最大障碍。）", S: '钟子程' },
            { T: "王子豪线第一阶段结束。学术的碰撞，让我们的关系变得微妙而紧张，而她即将离去的事实，也为这段关系蒙上了一层阴影。", S: '旁白', E: 'WZ_ROUTE_2_CHEMISTRY_AND_ENGLISH' }
        ],
        WZ_ROUTE_2_CHEMISTRY_AND_ENGLISH: [
            { B: 'classroom', T: "生物竞赛结束后，我们顺利地拿到了不错的成绩，但我的心神，已经被王子豪即将离开的事实所占据。" },
            { L: '王子豪', R: '钟子程', T: "（课间，王子豪正在准备她的英语竞赛）钟子程，你这次生物竞赛的成绩…刻板地来说，算是优秀。这其中，有我化学知识的功劳。", S: '王子豪', L_exp: 'proud', R_exp: 'default' },
            { S: '钟子程', T: "当然。为了感谢你，我决定在你的英语竞赛上，做你的‘外援’。虽然我的英语不如你，但我可以帮你整理思路。", R: '钟子程', L: '王子豪', L_exp: 'proud', R_exp: 'happy' },
            { S: '王子豪', T: "（她有些意外，但很快掩饰）…不需要。你这种刻板的帮助，只会拖慢我的进度。我只需要你…在精神上支持即可。", L: '王子豪', L_exp: 'tsundere', R: null, Affinity: { Affection_WZ: 5 } },
            { T: "（虽然嘴上拒绝，但她还是把一份关于'国际化学与可持续发展'的英文资料递给了我。）", S: '旁白' },
            { S: '钟子程', T: "这是…你英语竞赛的阅读材料？竟然涉及到了这么复杂的化学前沿课题。", L: '钟子程', R: '王子豪', R_exp: 'shy', L_exp: 'thought' },
            { S: '王子豪', T: "哼。我的未来是化学。刻板的英语竞赛，只是我通往未来的一道…手续。你帮我…翻译一下这些刻板的俚语。我不太懂这种…非学术的语言。", L: '王子豪', L_exp: 'thought', R: null },
            { T: "从那天起，我成了王子豪的英语/化学文献翻译机和中文俚语顾问。我们的相处时间，比以往任何时候都长。", S: '旁白', E: 'WZ_ROUTE_2_ROOFTOP_CONFESSION_PREP' }
        ],
        WZ_ROUTE_2_ROOFTOP_CONFESSION_PREP: [
            { B: 'rooftop', T: "某个傍晚，我们又来到了天台。她将一张填满化学分子式和复杂反应条件的草稿纸铺在地上，准备跟我讨论。", S: '旁白' },
            { L: '王子豪', R: '钟子程', T: "（王子豪指着一个分子式）钟子程。你在生物学里，研究过DNA的损伤修复吗？这涉及到一种叫烷化剂（Alkylating Agent）的化学物质。", S: '王子豪', L_exp: 'thought', R_exp: 'default' },
            { S: '钟子程', T: "研究过。烷化剂会改变DNA的碱基结构，导致基因突变。这是非常危险的化学物质。", R: '钟子程', L: '王子豪', L_exp: 'thought', R_exp: 'default' },
            { S: '王子豪', T: "（她的声音低沉，带着一丝感伤）没错。你知道吗？化学的世界，就是如此。它能创造出最美妙的物质，也能瞬间…摧毁一切。就像…感情。", L: '王子豪', L_exp: 'sad', R_exp: 'shy', Affinity: { Affection_WZ: 8 } },
            { S: '钟子程', T: "（我看着她，心头一颤）王子豪，你在说什么？", R: '钟子程', L: '王子豪', L_exp: 'sad', R_exp: 'default' },
            { S: '王子豪', T: "（她没有看我，而是看向远方的夕阳）我…我有时候想，如果你毕业后…也打算和我一样，去海外深造。我们…我们是不是就能继续这种刻板的…合作关系？", L: '王子豪', L_exp: 'shy', R: '钟子程', R_exp: 'thought' },
            { S: '钟子程', T: "（这是她第一次，如此直接地提到未来和我们的关系。）王子豪，你…", R: '钟子程', L: '王子豪', L_exp: 'shy', R_exp: 'thought' },
            { S: '王子豪', T: "（她猛地站起身，语气恢复了傲娇）不用多管闲事！我只是…刻板地询问你的职业规划！你回答我的问题！你的梦想，是留在国内，还是…和我一样，去追求世界的学术前沿？", L: '王子豪', L_exp: 'tsundere', R: '钟子程', R_exp: 'thought' },
            { T: "她的问题像一枚重磅炸弹，直接砸在了我的心房。这是我无法逃避的抉择，也是决定我们关系走向的关键。", S: '旁白', E: 'CHOICE_8_FUTURE_PLAN' }
        ],
        CHOICE_8_FUTURE_PLAN: {
            T: "（王子豪的未来规划，让你必须做出关于自己前途的抉择。你的回答将直接影响她对你的情感预期。）",
            Choices: [
                { Text: "告诉她，你愿意为了与她继续合作，认真考虑去海外深造生物学。（高好感度选项）", Next: 'WZ_ROUTE_2_A_ALIGN_FUTURE', Affinity: { Affection_WZ: 20 } },
                { Text: "告诉她，你的梦想是留在国内顶尖院校，深耕本土生物学，但承诺会保持联系。", Next: 'WZ_ROUTE_2_B_STICK_TO_PLAN', Affinity: { Affection_WZ: 5 } },
                { Text: "回避，强调当下竞赛的重要性，不谈及未来。", Next: 'WZ_ROUTE_2_C_AVOIDANCE', Affinity: { Affection_WZ: -5 } },
            ]
        },
        WZ_ROUTE_2_A_ALIGN_FUTURE: [
            { S: '钟子程', T: "（我坚定地站起来，走到她身边）王子豪。我决定了。为了能和你继续这种跨学科的合作，我愿意认真考虑去海外深造生物学。你的目标，也是我的目标。", L: '钟子程', R: '王子豪', L_exp: 'love', R_exp: 'shy' },
            { S: '王子豪', T: "（她猛地转过头，知性的脸颊染上了一层红晕，眼神中充满了惊喜和不确定）你…你在说什么刻板的话？这种重大的决定…你以为是…狗叫一般的玩笑吗？", L: '王子豪', L_exp: 'blush', R: null, Affinity: { Affection_WZ: 10 } },
            { S: '钟子程', T: "不是玩笑。我相信你的学术眼光。我不想失去你这个优秀的搭档。如果你愿意，我们可以一起去追求世界的学术前沿。", R: '钟子程', L: '王子豪', L_exp: 'love', R_exp: 'blush' },
            { S: '王子豪', T: "（她用手推了推眼镜，努力维持平静）…哼。好吧。既然你都做出了如此…刻板的决定。那么，我勉强…承认你的努力。从现在开始，除了生物竞赛，我们还要开始学习托福词汇。", L: '王子豪', L_exp: 'tsundere', R: null },
            { T: "（她的傲娇之下，是无法掩饰的喜悦。我们之间的未来，似乎第一次有了清晰的轮廓。）", S: '旁白', E: 'WZ_ROUTE_2_ENGLISH_CLIMAX' }
        ],
        WZ_ROUTE_2_B_STICK_TO_PLAN: [
            { S: '钟子程', T: "（我推了推眼镜）王子豪，我的梦想是留在国内顶尖院校，深耕本土生物学。那里的研究环境对我有特殊的吸引力。但请相信，无论多远，我都会保持与你的学术联系。", L: '钟子程', R: '王子豪', L_exp: 'thought', R_exp: 'sad' },
            { S: '王子豪', T: "（她眼神黯淡，失望一闪而过）…是吗。留在国内…刻板的选择。好吧。我理解。学术的道路，本就该是孤独的。", L: '王子豪', L_exp: 'sad', R: '钟子程', R_exp: 'thought' },
            { T: "（虽然好感度增加，但她对未来的失望，让我们的关系蒙上了一层悲伤的底色。）", S: '旁白', E: 'WZ_ROUTE_2_ENGLISH_CLIMAX' }
        ],
        WZ_ROUTE_2_C_AVOIDANCE: [
            { S: '钟子程', T: "（我挠了挠头，避开她的目光）哎呀，现在谈未来太早了吧！我们应该专注于眼前的生物竞赛。这才是李洁老师刻板的要求啊！", L: '钟子程', R: '王子豪', L_exp: 'embarrassed', R_exp: 'tsundere', Affinity: { Affection_WZ: -5 } },
            { S: '王子豪', T: "（她愤怒地将手中的草稿纸揉成一团）你真是个…刻板的懦夫！连直面未来的勇气都没有！你的回答，简直是…狗叫！我不需要你这种…不负责任的搭档！", L: '王子豪', L_exp: 'tsundere', R: null },
            { T: "她说完，头也不回地跑下了天台。我站在原地，尝到了逃避的苦果。", S: '旁白', E: 'WZ_ROUTE_2_ENGLISH_CLIMAX' } 
        ],
        WZ_ROUTE_2_ENGLISH_CLIMAX: [
            { B: 'classroom', T: "王子豪的英语竞赛来临了。我们一起走进考场，她显得比生物竞赛时更加紧张。", S: '旁白' },
            { L: '王子豪', R: '钟子程', T: "（她坐在我身边，低声说）钟子程。我…我不太擅长这种…刻板的即兴演讲。我的优势只在于…严谨的学术文本阅读。", S: '王子豪', L_exp: 'shy', R_exp: 'default' },
            { S: '钟子程', T: "没关系。你只要把你的化学知识，用你最流利的英文表达出来，用你的专业性去压倒一切！", R: '钟子程', L: '王子豪', L_exp: 'shy', R_exp: 'happy' },
            { T: "（考试开始。我看着王子豪在演讲环节，用近乎完美的口音和词汇，阐述着关于'绿色化学'的未来。她的自信，在那一刻完全掩盖了她的傲娇。）", S: '旁白' },
            { T: "竞赛结束后，我们一起去校门口等车。她看起来疲惫，但眼神中却充满了胜利的光芒。", S: '旁白', E: 'WZ_ROUTE_2_HAND_HOLDING' }
        ],
        WZ_ROUTE_2_HAND_HOLDING: [
            { B: 'street', L: '王子豪', R: '钟子程', T: "（公交车来了。上车时，我看到她差点被挤倒，下意识地伸出手，抓住了她的手腕。）", S: '旁白' },
            { S: '王子豪', T: "（她触电般地抽回手，脸颊瞬间爆红）…你…你在做什么刻板的…狗叫行为？", L: '王子豪', L_exp: 'blush', R_exp: 'shy' },
            { S: '钟子程', T: "（我的脸也红了，但没有回避）抱歉，我怕你摔倒。王子豪，你的手…很冰。你刚才很紧张吧？", R: '钟子程', L: '王子豪', L_exp: 'blush', R_exp: 'default', Affinity: { Affection_WZ: 10 } },
            { S: '王子豪', T: "（她低着头，声音低得像蚊子叫）…只是…刻板的体温调节失衡。你…你不许对任何人说。", L: '王子豪', L_exp: 'shy', R: null },
            { T: "（我没有再说话，只是默默地站到了她的身边，用自己的身体为她隔开拥挤的人群。我们之间，只隔着一个拳头的距离。）", S: '旁白' },
            { S: '钟子程', T: "（在拥挤的人群中，我的手臂不经意间碰到了她的胳膊。她没有躲开。）", S: '钟子程', L: '王子豪', L_exp: 'shy', R_exp: 'love' },
            { T: "我们安静地度过了回家的路程。她那份傲娇的坚冰，在一点点融化。而我们即将离别的事实，也迫使着我，必须做出最后的情感抉择。", S: '旁白', E: 'WZ_ROUTE_3_FINAL_CONFRONTATION' }
        ],
        WZ_ROUTE_3_FINAL_CONFRONTATION: [
            { B: 'rooftop', T: "（距离王子豪提交出国申请的日期只剩下一周。我们再次来到这个承载了我们许多学术讨论的天台。）", S: '旁白' },
            { L: '王子豪', R: '钟子程', T: "钟子程。我的申请材料已经准备好了。我获得了…一所顶尖大学的预录取通知。他们的化学系，是世界…最前沿的。", S: '王子豪', L_exp: 'calm', R_exp: 'shy' },
            { S: '钟子程', T: "（我感到一阵心痛，但我努力平静下来）恭喜你，王子豪。这是你努力的刻板回报。", R: '钟子程', L: '王子豪', L_exp: 'calm', R_exp: 'thought' },
            { S: '王子豪', T: "（她突然转过身，背对着我）刻板？你以为，我回国是为了什么？我以为…我们之间的合作，会有一个…共同的刻板未来！", L: '王子豪', L_exp: 'tsundere', R: null, Affinity: { Affection_WZ: 5 } },
            { S: '钟子程', T: "王子豪！别再用刻板来掩饰你的不善言辞了！你是在对我发火吗？你是在责怪我没有跟你做出同样的选择吗？", R: '钟子程', L: '王子豪', L_exp: 'tsundere', R_exp: 'default' },
            { S: '王子豪', T: "（她猛地转过身，眼镜下的眼睛里充满了泪水，但她依然紧紧地咬着嘴唇）你…你是个笨蛋！我…我不想一个人走！但我不能…放弃我的学术目标！你总是那么…冷静！", L: '王子豪', L_exp: 'sad', R: null },
            { S: '钟子程', T: "（我走上前，轻轻地，将她的手握住）我不冷静。王子豪，我从看到你的第一眼起，心跳就没再刻板地按照生理规律跳动过。", R: '钟子程', L: '王子豪', L_exp: 'sad', R_exp: 'love', Affinity: { Affection_WZ: 10 } },
            { S: '王子豪', T: "（她的身体在颤抖）你…你说的，是…狗叫吗？", L: '王子豪', L_exp: 'shy', R: null },
            { T: "（我意识到，现在是唯一的，也是最后的告白机会。）", S: '钟子程', E: 'CHOICE_9_CONFESSION' }
        ],
        CHOICE_9_CONFESSION: {
            T: "（面对离别前的感情爆发，你必须做出最终的告白，并给出承诺。）",
            Choices: [
                { Text: "「我爱你，王子豪。我们异地恋吧，两年后我去找你。」（高好感度，承诺异地）", Next: 'WZ_ROUTE_3_A_CONFESS_GE', Affinity: { Affection_WZ: 25 } },
                { Text: "「我喜欢你，但我不能放弃国内的梦想。如果这是离别，请接受这份刻板的心意。」", Next: 'WZ_ROUTE_3_B_CONFESS_BE', Affinity: { Affection_WZ: 10 } }, 
                { Text: "「你是我最优秀的搭档。毕业后，我们依然是最好的学术伙伴。」（友情线）", Next: 'WZ_ROUTE_3_C_FRIENDZONE_BE', Affinity: { Affection_WZ: -10 } },
            ]
        },
        WZ_ROUTE_3_A_CONFESS_GE: [
            { B: 'rooftop', L: '王子豪', R: '钟子程', T: "（我紧紧地抱住了她，将她冰冷的身体融入怀中。）", S: '钟子程', L_exp: 'blush', R_exp: 'love' },
            { S: '王子豪', T: "（她紧紧地回抱住我，声音带着哭腔）你…你是个笨蛋！异地恋？你以为那是…刻板的儿戏吗？", L: '王子豪', L_exp: 'blush', R: null, Affinity: { Affection_WZ: 10 } },
            { S: '钟子程', T: "不是儿戏。你追求你的化学前沿，我深耕我的生物领域。我们用视频电话，用邮件，用一切方式，证明这段感情可以超越刻板的距离。两年后，我一定会去找你。", R: '钟子程', L: '王子豪', L_exp: 'blush', R_exp: 'love' },
            { S: '王子豪', T: "（她抬起头，眼神中的傲娇彻底消失，只剩下爱意和泪水）好…钟子程。我勉强…接受你这个…狗叫一般的承诺。你…你一定要来。", L: '王子豪', L_exp: 'happy', R: null },
            { T: "（我们在天台上接吻，夕阳为我们镀上了一层金色的光芒。离别，成为了新的开始。）", S: '旁白' },
            { T: "后记：高三毕业，王子豪去了海外，而我留在了国内顶尖生物系。我们的每天从早晨的视频通话和跨国邮件开始。两年后，我通过了联合培养项目，飞往海外，与王子豪团聚。我们用行动证明，最坚固的爱，是用学术和承诺铸成的。", S: '旁白', E: 'END_WZ' }
        ],
        WZ_ROUTE_3_B_CONFESS_BE: [
            { B: 'rooftop', L: '王子豪', R: '钟子程', T: "（我用诚挚的眼神看着她，但没有走近。）", S: '钟子程', L_exp: 'shy', R_exp: 'thought' },
            { S: '王子豪', T: "（她的身体微微颤抖，眼神中的泪水收了回去，变得冰冷）…刻板的心意。所以…这就是你给出的…最优解？选择刻板的留守，放弃…无限的可能性？", L: '王子豪', L_exp: 'sad', R: null, Affinity: { Affection_WZ: -5 } },
            { S: '钟子程', T: "我的梦想，在国内。我不能放弃我的生物研究。王子豪，我希望你能理解。", R: '钟子程', L: '王子豪', L_exp: 'sad', R_exp: 'shy' },
            { S: '王子豪', T: "（她转过身，声音恢复了傲慢）我…我明白了。我早就知道，你是个刻板的懦夫。你的心意…太廉价了。从现在起，我们之间只有…学术交流。再见，钟子程。", L: '王子豪', L_exp: 'tsundere', R: null },
            { T: "她头也不回地离开了。我站在空荡荡的天台上，看着夕阳彻底落下。那份未能跨越距离的感情，成为了我心中永远的遗憾。", S: '旁白' },
            { T: "后记：王子豪毕业后去了海外，我留在国内。我们偶尔通过邮件讨论学术问题，但她的回复总是简短而客套。我们都实现了各自的学术目标，但却永远失去了彼此。那份刻板的执着，最终成为了我们爱情的'非最优解'。", S: '旁白', E: 'END_WZ' }
        ],
        WZ_ROUTE_3_C_FRIENDZONE_BE: [
            { B: 'rooftop', L: '王子豪', R: '钟子程', T: "（我试图用理性来平息她的愤怒，但她只是冷冷地看着我。）", S: '钟子程', L_exp: 'embarrassed', R_exp: 'tsundere' },
            { S: '王子豪', T: "（她冷笑了一声）学术伙伴？钟子程。你真是…太刻板了。你以为…你避开感情的复杂性，就能得到完美的…最优解吗？", L: '王子豪', L_exp: 'tsundere', R: null, Affinity: { Affection_WZ: -10 } },
            { S: '钟子程', T: "我…", R: '钟子程', L: '王子豪', L_exp: 'tsundere', R_exp: 'shy' },
            { S: '王子豪', T: "（她抬手，轻轻地，但坚定地推开了我）你的刻板…是对我最大的侮辱。我不需要这种…狗叫般的友情。我希望我的未来…充满无限的可能性，而不是你这种…懦弱的确定性。滚吧。", L: '王子豪', L_exp: 'sad', R: null },
            { T: "她转身跑走，留下了我一个人。那份傲娇之下的真心，被我彻底扼杀在了摇篮里。我的心，如同被烷化剂腐蚀了一般，疼痛而空虚。", S: '旁白' },
            { T: "后记：王子豪彻底断绝了与我的联系，专注于她的海外学业。我专注于生物研究，成为了一名优秀的科学家。多年后，我在国际期刊上看到她发表的论文，署名已是她的英文名。我们都在学术上获得了成就，但那份刻板的傲慢和我的懦弱，让我们成为了两条永不相交的平行线。", S: '旁白', E: 'END_WZ' }
        ],
        WZ_ROUTE_ENDING_CHECK: [
            { S: '旁白', T: "（好感度检查：王子豪好感度：${Affection_WZ} / 100）", E: 'JUMP_TO_WZ_ENDING' }
        ],
        JUMP_TO_WZ_ENDING: {
            T: "跳转到王子豪结局...",
            Choices: [
                { Text: "（好感度足够）进入 Good Ending", Next: 'WZ_ROUTE_3_A_CONFESS_GE', Condition: (gameState) => gameState.Affection_WZ >= 50 },
                { Text: "（好感度不足）进入 Bad Ending", Next: 'WZ_ROUTE_3_B_CONFESS_BE', Condition: (gameState) => gameState.Affection_WZ < 50 }
            ]
        },

        // --- 李洁线 剧情 ---
        LJ_ROUTE_START: [
            { B: 'office', T: "（我走到教师办公室门口，深吸一口气。选择李洁老师作为竞赛搭档，本身就意味着这条路注定不会平凡。）", S: '旁白' },
            { L: '李洁', R: '钟子程', T: "（李洁老师抬起头，看到我，露出了一个鼓励的微笑）子程，进来。我知道你会来找我。坐吧。", S: '李洁', L_exp: 'warm', R_exp: 'default' },
            { S: '钟子程', T: "李老师，关于生物竞赛，我希望能得到您最专业的指导。您说您会亲自帮我组织备考，我非常感激。", R: '钟子程', L: '李洁', L_exp: 'warm', R_exp: 'happy', Affinity: { Affection_LJ: 5 } },
            { S: '李洁', T: "你是我的骄傲。你的生物天赋，在国内数一数二。但我对你的要求，绝不仅仅是高中知识的刻板重复。我们需要跨越**师生**的界限，进入**导师与门徒**的关系。", L_exp: 'strict', R: null },
            { S: '钟子程', T: "（我心头一震。导师与门徒？这个词似乎有更深的含义。）我明白，李老师。我愿意接受任何挑战。", R: '钟子程', L: '李洁', L_exp: 'strict', R_exp: 'thought' },
            { T: "从那天起，我的课后时间都被李洁老师占满了。我们没有在喧闹的图书馆，而是在安静的办公室，进行一对一的辅导。", S: '旁白', E: 'LJ_ROUTE_1_CLOSE_CONTACT' }
        ],
        LJ_ROUTE_1_CLOSE_CONTACT: [
            { B: 'office', T: "（办公室里只有我和李洁老师。她靠得很近，指着我的笔记，她的短发和身上淡淡的香气让我有些心猿意马。）", S: '旁白' },
            { L: '李洁', R: '钟子程', T: "（她指着一个分子结构）子程，这里的细胞周期调控，你画的G1期检查点过于**刻板**。你要将它视为一个动态的**反馈回路**。理解反馈回路的动态性，是生物学研究的起点。", S: '李洁', L_exp: 'thought', R_exp: 'shy' },
            { S: '钟子程', T: "是…是，李老师。您的思路比课本要前沿得多。我感觉…您的知识储备，完全是大学教授级别的。", R: '钟子程', L: '李洁', L_exp: 'thought', R_exp: 'embarrassed', Affinity: { Affection_LJ: 5 } },
            { S: '李洁', T: "（她轻轻笑了，眼神中流露出一丝不易察觉的温柔）谢谢你的赞美。我在大学时，选择了生物和哲学双学位。所以我的思考方式，可能会有些…刻板的跳跃性。", L_exp: 'warm', R: null },
            { T: "（她的笑容很迷人。我发现，李洁老师虽然要求严厉，但在私下里，她又显得很温柔、很体贴。）", S: '钟子程' },
            { S: '李洁', T: "（她突然站起来，走到饮水机旁，为我倒了一杯热水）最近天气转凉，不要总是喝冷水。你瘦弱的身体，需要刻板的保护。", L: '李洁', L_exp: 'warm', R: '钟子程', R_exp: 'default' },
            { S: '钟子程', T: "（我接过水杯，指尖不经意地碰到了她的手。她的手很温暖。）谢谢您，李老师。您…您总是这么体贴。", R: '钟子程', L: '李洁', L_exp: 'shy', R_exp: 'shy', Affinity: { Affection_LJ: 5 } },
            { S: '李洁', T: "（她推了推眼镜，眼神恢复了平静，但脸颊似乎泛起了一丝红晕）这是…刻板的师生关怀。别想太多。好了，我们继续。这道题是关于‘朊病毒’（Prion）的，需要你用更宏观的生物学视角去看待。", L: '李洁', L_exp: 'strict', R: null, L_exp: 'blush' },
            { T: "那天的辅导直到天黑才结束。我感觉，我们的关系，已经不再是简单的师生关系了。", S: '旁白', E: 'LJ_ROUTE_1_DINNER_INVITE' }
        ],
        LJ_ROUTE_1_DINNER_INVITE: [
            { B: 'hallway', T: "（走出办公室，已经是晚上七点。我肚子饿得咕咕叫。）", S: '旁白' },
            { L: '李洁', R: '钟子程', T: "子程，今天辛苦了。我请你吃晚饭吧。学校食堂已经关了，我们去外面吃。这是…刻板的奖励。", S: '李洁', L_exp: 'warm', R_exp: 'default', Affinity: { Affection_LJ: 5 } },
            { S: '钟子程', T: "（我有些激动）好啊！李老师，您想吃什么？", R: '钟子程', L: '李洁', L_exp: 'warm', R_exp: 'happy' },
            { T: "我们来到学校附近的一家安静的餐厅，点了菜。这是我第一次和李洁老师在如此轻松的环境下独处。", S: '旁白', B: 'canteen' },
            { S: '李洁', T: "（李洁老师看着我）钟子程，你对生物学的未来，有什么规划？我的大学同学现在大部分都在研究所或者海外名校，你可以选择其中任何一条路。", L_exp: 'thought', R: '钟子程', R_exp: 'default' },
            { S: '钟子程', T: "我想继续在生物学领域深造。李老师，您的研究方向是什么？我能从您的经验中，得到最宝贵的指导。", R: '钟子程', L: '李洁', L_exp: 'thought', R_exp: 'thought', Affinity: { Affection_LJ: 5 } },
            { S: '李洁', T: "（她放下筷子，眼神复杂）我的研究方向…涉及一些神经生物学。钟子程，你太专注学术了。你有没有想过…你的人生，还有除了学术之外的…刻板的追求？", L_exp: 'sad', R: null },
            { S: '钟子程', T: "（我心头一跳。她似乎在暗示什么。）李老师…您是指…感情吗？", R: '钟子程', L: '李洁', L_exp: 'sad', R_exp: 'shy' },
            { S: '李洁', T: "（她迅速恢复了平静，但脸颊更红了）我是说…羽毛球。你是班里的高手。你应该有更刻板的社交活动。", L_exp: 'blush', R: null },
            { T: "（李老师的傲娇，虽然不如王子豪那么直接，但这种刻意的回避，反而让我更加确信了她的心意。）", S: '钟子程', E: 'CHOICE_10_RELATIONSHIP_HINT' }
        ],
        CHOICE_10_RELATIONSHIP_HINT: {
            T: "（李洁老师在紧张地掩饰她的心意，你该如何回应，才能跨越师生间的界限？）",
            Choices: [
                { Text: "「李老师，您是第一个让我感受到，学术之外的关怀和温暖的人。」（高好感度）", Next: 'LJ_ROUTE_1_A_WARMTH', Affinity: { Affection_LJ: 15 } },
                { Text: "「我知道了，李老师。我保证会刻板地平衡学习和羽毛球。」", Next: 'LJ_ROUTE_1_B_COMPLIANCE', Affinity: { Affection_LJ: 3 } },
                { Text: "「李老师，您是不是在担心我因为学习压力太大而抑郁？请不要过度担忧。」", Next: 'LJ_ROUTE_1_C_RATIONALIZE', Affinity: { Affection_LJ: -5 } },
            ]
        },
        LJ_ROUTE_1_A_WARMTH: [
            { S: '钟子程', T: "（我认真地看着她的眼睛）李老师，您是第一个让我感受到，学术之外的关怀和温暖的人。您就像一束光，照亮了我刻板的生物学世界。", R: '钟子程', L: '李洁', R_exp: 'love', L_exp: 'blush' },
            { S: '李洁', T: "（她猛地低下头，眼镜险些滑落，声音颤抖）你…你在说什么刻板的…学生语言！快…快吃饭！不然我会刻板地…生气！", L_exp: 'blush', R: null, Affinity: { Affection_LJ: 10 } },
            { T: "（虽然她生气了，但我能看到她眼中那一闪而过的喜悦。师生之间的界限，正在悄然瓦解。）", S: '旁白', E: 'LJ_ROUTE_2_PRIVATE_STUDY' }
        ],
        LJ_ROUTE_1_B_COMPLIANCE: [
            { S: '钟子程', T: "我知道了，李老师。我保证会刻板地平衡学习和羽毛球。绝不会让您担心。", R: '钟子程', L: '李洁', R_exp: 'default', L_exp: 'warm' },
            { S: '李洁', T: "（她的眼中有一丝不易察觉的失望，但很快恢复了严厉）嗯。记住你的承诺。你是较劲中学最有天赋的学生。不容许刻板的失误。", L_exp: 'strict', R: null },
            { T: "（我错过了机会。但她依然对我很好，只是那种微妙的情感，被压抑得更深了。）", S: '旁白', E: 'LJ_ROUTE_2_PRIVATE_STUDY' }
        ],
        LJ_ROUTE_1_C_RATIONALIZE: [
            { S: '钟子程', T: "李老师，您是不是在担心我因为学习压力太大而抑郁？请不要过度担忧。我会用我刻板的生物学知识，来调节我的情绪。", R: '钟子程', L: '李洁', R_exp: 'thought', L_exp: 'sad', Affinity: { Affection_LJ: -5 } },
            { S: '李洁', T: "（她无奈地摇了摇头，眼神中充满了复杂和失望）你总是这么…刻板。算了。我只是…在尽一个老师的本分。吃饭吧。", L_exp: 'sad', R: null },
            { T: "（我似乎说错了话。她那份难得流露出的情感，被我理性地推开了。我感觉，她离我更远了。）", S: '旁白', E: 'LJ_ROUTE_2_PRIVATE_STUDY' }
        ],
        LJ_ROUTE_2_PRIVATE_STUDY: [
            { B: 'office', T: "（我们的竞赛辅导仍在继续。李洁老师越来越喜欢在晚上，等其他老师都走光后，才开始我们的私密辅导。）", S: '旁白' },
            { L: '李洁', R: '钟子程', T: "子程，这道关于基因编辑的分析题，关键在于伦理和哲学的讨论。你只需要刻板地思考科学的边界即可。", S: '李洁', L_exp: 'thought', R_exp: 'thought' },
            { S: '钟子程', T: "李老师，我最近查阅了大量资料。发现生物学和哲学结合的领域非常有趣。您是如何平衡这两者的？", R: '钟子程', L: '李洁', L_exp: 'thought', R_exp: 'default' },
            { S: '李洁', T: "（她轻轻转动笔，眼神复杂）平衡？这个词太刻板了。很多时候，它们是矛盾的。就像…很多感情一样。科学需要理性，感情需要感性。你认为…哪一个更重要？", L_exp: 'sad', R: '钟子程', R_exp: 'thought', Affinity: { Affection_LJ: 5 } },
            { T: "（她的问题，总是在不经意间触及我们关系的敏感地带。）", S: '钟子程', E: 'CHOICE_11_RATIONAL_OR_EMOTION' }
        ],
        CHOICE_11_RATIONAL_OR_EMOTION: {
            T: "（她问你理性和感性哪个更重要，这是对你情感倾向的试探。）",
            Choices: [
                { Text: "「在学术上，理性最重要；但在人生的路上，我希望能追随我的心。」（暗示情感）", Next: 'LJ_ROUTE_2_A_EMOTIONAL', Affinity: { Affection_LJ: 15 } },
                { Text: "「老师，当然是理性。我们是未来的科学家，必须保持刻板的理性。」（强化理性）", Next: 'LJ_ROUTE_2_B_RATIONAL', Affinity: { Affection_LJ: -5 } },
            ]
        },
        LJ_ROUTE_2_A_EMOTIONAL: [
            { S: '钟子程', T: "（我直视着她）李老师。在学术上，理性最重要；但在人生的路上，我希望能追随我的心。它指引我，走向那些…刻板的界限之外。", R: '钟子程', L: '李洁', R_exp: 'love', L_exp: 'blush' },
            { S: '李洁', T: "（她的呼吸变得急促，猛地收回了目光）刻板的界限…之外吗？钟子程，你…你太大胆了。这种想法…不符合…师生规范。", L_exp: 'strict', R: null, Affinity: { Affection_LJ: 10 } },
            { T: "（李老师的声音虽然严厉，但语气中却带着一丝无法掩饰的颤抖。我知道，我成功地打破了她内心的一部分防线。）", S: '旁白' },
            { S: '李洁', T: "（她站起身，走到窗边，背对着我）今天到此为止。你走吧。回去后，不要再思考这些刻板的…哲学问题。", L_exp: 'sad', R: null },
            { T: "（我没有离开，只是默默地收拾着桌子。我能感受到她背影中压抑的情感。）", S: '钟子程', E: 'LJ_ROUTE_2_CLOSURE' }
        ],
        LJ_ROUTE_2_B_RATIONAL: [
            { S: '钟子程', T: "老师，当然是理性。我们是未来的科学家，必须保持刻板的理性。感情是低效的变数。", R: '钟子程', L: '李洁', R_exp: 'thought', L_exp: 'sad', Affinity: { Affection_LJ: -5 } },
            { S: '李洁', T: "（她深深地叹了口气，眼中充满了失望）是啊。理性。你说的刻板正确。但…你难道不会觉得，这种绝对的理性，会让你失去一些…刻板的美好吗？", L: '李洁', L_exp: 'sad', R: null },
            { T: "（我不知道她说的‘美好’是什么。但看着她失落的表情，我的心底划过一丝不安。）", S: '旁白', E: 'LJ_ROUTE_2_CLOSURE' }
        ],
        LJ_ROUTE_2_CLOSURE: [
            { B: 'hallway', T: "（我走出办公室，看到李洁老师站在门口，似乎在等我。）", S: '旁白' },
            { L: '李洁', R: '钟子程', T: "子程。记住，这次竞赛对你来说，非常重要。这是你证明自己的机会。不要被任何…刻板的变数影响。", S: '李洁', L_exp: 'strict', R_exp: 'default' },
            { S: '钟子程', T: "李老师，我不会让您失望的。我一定会拿到一等奖，为您证明您的教导是最好的。", R: '钟子程', L: '李洁', L_exp: 'strict', R_exp: 'happy' },
            { S: '李洁', T: "（她突然向前走了一小步，轻轻地，像是整理我的衣领，指尖触碰到了我的皮肤。）我期待…你的成功。晚安。", L_exp: 'warm', R: null, Affinity: { Affection_LJ: 5 } },
            { T: "（那份轻微的触碰，让我全身的血液都沸腾了。这种介于师生和暧昧之间的关系，让我感到既刺激又痛苦。）", S: '钟子程', E: 'LJ_ROUTE_3_CLIMAX_PREP' }
        ],
        LJ_ROUTE_3_CLIMAX_PREP: [
            { B: 'classroom', T: "生物竞赛的日子到了。李洁老师是唯一的监考老师。考场里弥漫着只有我们两人能感受到的紧张氛围。", S: '旁白' },
            { L: '李洁', T: "（李洁老师站在讲台上，推了推眼镜）钟子程。请开始答题。记住，展现你所有的天赋。不要有任何刻板的保留。", S: '李洁', L_exp: 'strict', R: '钟子程', R_exp: 'thought' },
            { T: "竞赛过程出乎意料的顺利，我的生物天赋在李洁老师的指导下得到了完美的释放。最终，我顺利完成了答题。", S: '旁白' },
            { B: 'office', T: "一周后，李洁老师把我叫到办公室。我看到了那份一等奖的通知单。", S: '旁白' },
            { L: '李洁', R: '钟子程', T: "（李洁老师脸上露出了骄傲的笑容）钟子程，恭喜你。一等奖。这是你应得的刻板回报。你的未来，已经打开了无限可能。", S: '李洁', L_exp: 'warm', R_exp: 'happy', Affinity: { Affection_LJ: 10 } },
            { S: '钟子程', T: "谢谢李老师。这份荣誉，有您一半的功劳。是您的指导，让我突破了知识的刻板界限。", R: '钟子程', L: '李洁', L_exp: 'warm', R_exp: 'happy' },
            { S: '李洁', T: "（她突然收起了笑容，眼神变得严肃而复杂）钟子程。我有一个问题，你必须回答。关于你毕业后的规划…你想去哪里深造？", L_exp: 'thought', R: null },
            { S: '钟子程', T: "（我知道，现在是揭开谜底的时候了。她不再问我感性的问题，而是问我未来的规划。这才是她内心真正的界限。）", R: '钟子程', E: 'CHOICE_12_FINAL_DECISION' }
        ],
        CHOICE_12_FINAL_DECISION: {
            T: "（毕业后，你将选择继续深造生物，实现你和李洁老师的共同愿景吗？）",
            Choices: [
                { Text: "「我决定考入顶尖大学的生物系，并在毕业后回到较劲中学，成为您的同事。」（GE：承诺共同的未来）", Next: 'LJ_ROUTE_3_A_GE', Affinity: { Affection_LJ: 25 } },
                { Text: "「我想去海外深造，追求更前沿的生物学研究，不被任何刻板的关系束缚。」（BE：选择学术自由）", Next: 'LJ_ROUTE_3_B_BE', Affinity: { Affection_LJ: 5 } },
            ]
        },
        LJ_ROUTE_3_A_GE: [
            { B: 'office', T: "（李洁老师震惊地看着我，眼镜下的眼睛里充满了不可置信和巨大的喜悦。）", S: '旁白' },
            { S: '李洁', T: "（声音颤抖）你…你在说什么？回到较劲中学…成为我的…同事？你以为师生关系…是如此轻易能打破的吗？", L_exp: 'sad', R: null },
            { S: '钟子程', T: "（我走上前，握住了她放在桌上的手）师生关系，只存在于现在。未来，您是我的同事，更是我心之所向。您不是想让我突破刻板的界限吗？这就是我的突破。", R: '钟子程', L: '李洁', R_exp: 'love', L_exp: 'blush', Affinity: { Affection_LJ: 15 } },
            { S: '李洁', T: "（她轻轻地回握住我的手，眼中充满了泪水）你…你真是个笨蛋。我…我等这一天…等了太久了。", L_exp: 'love', R: null },
            { T: "（她站起来，轻轻地，将她的身体融入我的怀中。那份严厉和体贴，在这一刻达到了完美的平衡。）", S: '旁白' },
            { S: '李洁', T: "（低声）钟子程。请你…刻板地…快点长大。我不想再扮演你的老师了。", L_exp: 'love', R: null },
            { T: "后记：我考入国内顶尖大学，选择了生物系师范方向。在大学的四年里，我和李洁老师保持着秘密的恋情。四年后，我正式回到较劲中学，成为了一名生物老师，与李洁成为了办公室里最默契的同事。", S: '旁白', E: 'END_LJ' }
        ],
        LJ_ROUTE_3_B_BE: [
            { B: 'office', T: "（李洁老师静静地听完我的回答，脸上的笑容消失了。）", S: '旁白' },
            { S: '李洁', T: "（她推了推眼镜，眼神恢复了最初的严厉和冷漠）是吗。去海外深造。这是个…刻板的选择。那么，你将不再需要我这位…刻板的老师了。", L_exp: 'strict', R: null, Affinity: { Affection_LJ: -10 } },
            { S: '钟子程', T: "李老师…我…我依然会保持联系。您是我的导师！", R: '钟子程', L: '李洁', L_exp: 'strict', R_exp: 'shy' },
            { S: '李洁', T: "（她冷冷地笑了笑）导师？钟子程。导师是指导你未来方向的人，而不是…束缚你脚步的刻板。你选择了自由，就请你刻板地，独自前行吧。", L_exp: 'strict', R: null },
            { T: "李洁老师转过身，将那份一等奖的通知单放在桌上。我走出去，身后是她决绝的背影。那份隐藏在师生关系下的情感，最终被我的理性选择彻底扼杀。", S: '旁白' },
            { T: "后记：我去了海外，在生物研究领域取得了巨大成功。但我再也没有收到李洁老师的任何消息。那份师生间的禁忌之爱，成为了一个永远无法解开的函数。我获得了学术自由，却失去了那份刻板的温暖。", S: '旁白', E: 'END_LJ' }
        ],
        LJ_ROUTE_ENDING_CHECK: [
            { S: '旁白', T: "（好感度检查：李洁好感度：${Affection_LJ} / 100）", E: 'JUMP_TO_LJ_ENDING' }
        ],
        JUMP_TO_LJ_ENDING: {
            T: "跳转到李洁结局...",
            Choices: [
                { Text: "（好感度足够）进入 Good Ending", Next: 'LJ_ROUTE_3_A_GE', Condition: (gameState) => gameState.Affection_LJ >= 50 },
                { Text: "（好感度不足）进入 Bad Ending", Next: 'LJ_ROUTE_3_B_BE', Condition: (gameState) => gameState.Affection_LJ < 50 }
            ]
        },
        
        // --- 苏天佑线 结局 ---
        ST_ROUTE_ENDING_CHECK: [
            { S: '旁白', T: "（好感度检查：苏天佑好感度：${Affection_ST} / 100）", E: 'JUMP_TO_ST_ENDING' }
        ],
        JUMP_TO_ST_ENDING: {
            T: "跳转到苏天佑结局...",
            Choices: [
                { Text: "（好感度足够）进入 Good Ending", Next: 'ST_ROUTE_END_GE', Condition: (gameState) => gameState.Affection_ST >= 50 },
                { Text: "（好感度不足）进入 Friendship Ending", Next: 'ST_ROUTE_END_FE', Condition: (gameState) => gameState.Affection_ST < 50 }
            ]
        },
        ST_ROUTE_END_GE: [
            { B: 'street', T: "（夜晚，我们再次来到那片空地。今晚的星空，比任何时候都明亮。）", S: '旁白' },
            { L: '苏天佑', R: '钟子程', T: "子程。我们成功了。竞赛的胜利，是…是最好的证明。", S: '苏天佑', L_exp: 'happy', R_exp: 'love' },
            { S: '钟子程', T: "是的。但对我来说，能看到你再次露出这么开心的笑容，比任何奖杯都重要。", R: '钟子程', L: '苏天佑', L_exp: 'happy', R_exp: 'love' },
            { S: '苏天佑', T: "（她走近我，轻声说）你还记得，竞赛前夜我问你的问题吗？关于…不再是青梅竹马？", L: '苏天佑', L_exp: 'blush', R: '钟子程', R_exp: 'love' },
            { S: '钟子程', T: "当然。天佑，现在我们赢了。现在…我要正式告诉你我的‘最优解’。", R: '钟子程', L: '苏天佑', L_exp: 'blush', R_exp: 'love' },
            { T: "（我伸出手，轻轻地，将她的眼镜摘下。她的眼睛，清澈而深情。）", S: '旁白' },
            { S: '钟子程', T: "苏天佑。你不是我的妹妹，也不是我的搭档。你是…我最喜欢的女孩。我们在一起吧。", R: '钟子程', L: '苏天佑', L_exp: 'blush', R_exp: 'love', Affinity: { Affection_ST: 10 } },
            { S: '苏天佑', T: "（她的声音充满了压抑已久的甜蜜）嗯…刻板地来说，这是我人生中…最完美的证明题。我…永远不会放弃你，子程。", L: '苏天佑', R: '钟子程', R_exp: 'love', L_exp: 'blush' },
            { T: "我们紧紧相拥。高三的生活充满了挑战和压力，但我们找到了彼此的‘最优解’。", S: '旁白' },
            { T: "后记：毕业后，苏天佑在数学领域继续深造，而我则考入了国内顶尖大学的生物系。每到周末，我们都会相约在羽毛球馆。我们的爱情，如同她的数学证明一样，严谨而美丽，经久不衰。", S: '旁白', E: 'END_ST' }
        ],
        ST_ROUTE_END_FE: [
            { B: 'gym', T: "（生物竞赛结束后，我们在羽毛球馆庆祝。苏天佑看起来非常高兴，但那份兴奋中，似乎缺少了某种光芒。）", S: '旁白' },
            { L: '苏天佑', R: '钟子程', T: "（她发出了一个完美的扣杀，我反应不及，球落在界内）赢了！子程，我们配合得越来越默契了！", S: '苏天佑', L_exp: 'happy', R_exp: 'default' },
            { S: '钟子程', T: "是啊，天佑。和你一起打球，永远是最开心的事。我们的默契，是独一无二的。", R: '钟子程', L: '苏天佑', L_exp: 'happy', R_exp: 'happy' },
            { S: '苏天佑', T: "（她平静地看着我，眼神很深）独一无二的…兄妹情谊。是吧？", L: '苏天佑', R: '钟子程', R_exp: 'default', L_exp: 'calm' },
            { S: '钟子程', T: "（我的心头一紧，但还是故作轻松地笑了）当然了！我的好妹妹，今天赢球，我请你吃冰淇淋！", R: '钟子程', L: '苏天佑', L_exp: 'calm', R_exp: 'happy' },
            { T: "苏天佑没有再追问。她平静地笑了笑，接受了我的提议。从那一刻起，我们之间未曾宣之于口的感情，被我们共同埋藏，用‘青梅竹马’和‘兄妹’的刻板称呼，永远地保护了起来。", S: '旁白' },
            { T: "多年后，苏天佑凭借她杰出的数学天赋，考取了全国数学竞赛的金牌，并选择了深造数学。而我也成为了生物学界的翘楚。", S: '旁白' },
            { T: "我们依然是彼此最亲密的伙伴。在每一个关键时刻，我们都会出现在彼此的身边。但那份最初的心动，却成为了一个永远没有解开的方程，留在了高三的记忆中。", S: '旁白', E: 'END_ST' }
        ],

        // --- 李洁线 剧情 ---
        LJ_ROUTE_START: [
            { B: 'office', T: "（我走到教师办公室门口，深吸一口气。选择李洁老师作为竞赛搭档，本身就意味着这条路注定不会平凡。）", S: '旁白' },
            { L: '李洁', R: '钟子程', T: "（李洁老师抬起头，看到我，露出了一个鼓励的微笑）子程，进来。我知道你会来找我。坐吧。", S: '李洁', L_exp: 'warm', R_exp: 'default' },
            { S: '钟子程', T: "李老师，关于生物竞赛，我希望能得到您最专业的指导。您说您会亲自帮我组织备考，我非常感激。", R: '钟子程', L: '李洁', L_exp: 'warm', R_exp: 'happy', Affinity: { Affection_LJ: 5 } },
            { S: '李洁', T: "你是我的骄傲。你的生物天赋，在国内数一数二。但我对你的要求，绝不仅仅是高中知识的刻板重复。我们需要跨越**师生**的界限，进入**导师与门徒**的关系。", L: '李洁', L_exp: 'strict', R: null },
            { S: '钟子程', T: "（我心头一震。导师与门徒？这个词似乎有更深的含义。）我明白，李老师。我愿意接受任何挑战。", R: '钟子程', L: '李洁', L_exp: 'strict', R_exp: 'thought' },
            { T: "从那天起，我的课后时间都被李洁老师占满了。我们没有在喧闹的图书馆，而是在安静的办公室，进行一对一的辅导。", S: '旁白', E: 'LJ_ROUTE_1_CLOSE_CONTACT' }
        ],
        LJ_ROUTE_1_CLOSE_CONTACT: [
            { B: 'office', T: "（办公室里只有我和李洁老师。她靠得很近，指着我的笔记，她的短发和身上淡淡的香气让我有些心猿意马。）", S: '旁白' },
            { L: '李洁', R: '钟子程', T: "（她指着一个分子结构）子程，这里的细胞周期调控，你画的G1期检查点过于**刻板**。你要将它视为一个动态的**反馈回路**。理解反馈回路的动态性，是生物学研究的起点。", S: '李洁', L_exp: 'thought', R_exp: 'shy' },
            { S: '钟子程', T: "是…是，李老师。您的思路比课本要前沿得多。我感觉…您的知识储备，完全是大学教授级别的。", R: '钟子程', L: '李洁', L_exp: 'thought', R_exp: 'embarrassed', Affinity: { Affection_LJ: 5 } },
            { S: '李洁', T: "（她轻轻笑了，眼神中流露出一丝不易察觉的温柔）谢谢你的赞美。我在大学时，选择了生物和哲学双学位。所以我的思考方式，可能会有些…刻板的跳跃性。", L_exp: 'warm', R: null },
            { T: "（她的笑容很迷人。我发现，李洁老师虽然要求严厉，但在私下里，她又显得很温柔、很体贴。）", S: '钟子程' },
            { S: '李洁', T: "（她突然站起来，走到饮水机旁，为我倒了一杯热水）最近天气转凉，不要总是喝冷水。你瘦弱的身体，需要刻板的保护。", L: '李洁', L_exp: 'warm', R: '钟子程', R_exp: 'default' },
            { S: '钟子程', T: "（我接过水杯，指尖不经意地碰到了她的手。她的手很温暖。）谢谢您，李老师。您…您总是这么体贴。", R: '钟子程', L: '李洁', L_exp: 'shy', R_exp: 'shy', Affinity: { Affection_LJ: 5 } },
            { S: '李洁', T: "（她推了推眼镜，眼神恢复了平静，但脸颊似乎泛起了一丝红晕）这是…刻板的师生关怀。别想太多。好了，我们继续。这道题是关于‘朊病毒’（Prion）的，需要你用更宏观的生物学视角去看待。", L: '李洁', L_exp: 'strict', R: null, L_exp: 'blush' },
            { T: "那天的辅导直到天黑才结束。我感觉，我们的关系，已经不再是简单的师生关系了。", S: '旁白', E: 'LJ_ROUTE_1_DINNER_INVITE' }
        ],
        LJ_ROUTE_1_DINNER_INVITE: [
            { B: 'hallway', T: "（走出办公室，已经是晚上七点。我肚子饿得咕咕叫。）", S: '旁白' },
            { L: '李洁', R: '钟子程', T: "子程，今天辛苦了。我请你吃晚饭吧。学校食堂已经关了，我们去外面吃。这是…刻板的奖励。", S: '李洁', L_exp: 'warm', R_exp: 'default', Affinity: { Affection_LJ: 5 } },
            { S: '钟子程', T: "（我有些激动）好啊！李老师，您想吃什么？", R: '钟子程', L: '李洁', L_exp: 'warm', R_exp: 'happy' },
            { T: "我们来到学校附近的一家安静的餐厅，点了菜。这是我第一次和李洁老师在如此轻松的环境下独处。", S: '旁白', B: 'canteen' },
            { S: '李洁', T: "（李洁老师看着我）钟子程，你对生物学的未来，有什么规划？我的大学同学现在大部分都在研究所或者海外名校，你可以选择其中任何一条路。", L_exp: 'thought', R: '钟子程', R_exp: 'default' },
            { S: '钟子程', T: "我想继续在生物学领域深造。李老师，您的研究方向是什么？我能从您的经验中，得到最宝贵的指导。", R: '钟子程', L: '李洁', L_exp: 'thought', R_exp: 'thought', Affinity: { Affection_LJ: 5 } },
            { S: '李洁', T: "（她放下筷子，眼神复杂）我的研究方向…涉及一些神经生物学。钟子程，你太专注学术了。你有没有想过…你的人生，还有除了学术之外的…刻板的追求？", L_exp: 'sad', R: null },
            { S: '钟子程', T: "（我心头一跳。她似乎在暗示什么。）李老师…您是指…感情吗？", R: '钟子程', L: '李洁', L_exp: 'sad', R_exp: 'shy' },
            { S: '李洁', T: "（她迅速恢复了平静，但脸颊更红了）我是说…羽毛球。你是班里的高手。你应该有更刻板的社交活动。", L: '李洁', L_exp: 'blush', R: null },
            { T: "（李老师的傲娇，虽然不如王子豪那么直接，但这种刻意的回避，反而让我更加确信了她的心意。）", S: '钟子程', E: 'CHOICE_10_RELATIONSHIP_HINT' }
        ],
        CHOICE_10_RELATIONSHIP_HINT: {
            T: "（李洁老师在紧张地掩饰她的心意，你该如何回应，才能跨越师生间的界限？）",
            Choices: [
                { Text: "「李老师，您是第一个让我感受到，学术之外的关怀和温暖的人。」（高好感度）", Next: 'LJ_ROUTE_1_A_WARMTH', Affinity: { Affection_LJ: 15 } },
                { Text: "「我知道了，李老师。我保证会刻板地平衡学习和羽毛球。」", Next: 'LJ_ROUTE_1_B_COMPLIANCE', Affinity: { Affection_LJ: 3 } },
                { Text: "「李老师，您是不是在担心我因为学习压力太大而抑郁？请不要过度担忧。」", Next: 'LJ_ROUTE_1_C_RATIONALIZE', Affinity: { Affection_LJ: -5 } },
            ]
        },
        LJ_ROUTE_1_A_WARMTH: [
            { S: '钟子程', T: "（我认真地看着她的眼睛）李老师，您是第一个让我感受到，学术之外的关怀和温暖的人。您就像一束光，照亮了我刻板的生物学世界。", R: '钟子程', L: '李洁', R_exp: 'love', L_exp: 'blush' },
            { S: '李洁', T: "（她猛地低下头，眼镜险些滑落，声音颤抖）你…你在说什么刻板的…学生语言！快…快吃饭！不然我会刻板地…生气！", L_exp: 'blush', R: null, Affinity: { Affection_LJ: 10 } },
            { T: "（虽然她生气了，但我能看到她眼中那一闪而过的喜悦。师生之间的界限，正在悄然瓦解。）", S: '旁白', E: 'LJ_ROUTE_2_PRIVATE_STUDY' }
        ],
        LJ_ROUTE_1_B_COMPLIANCE: [
            { S: '钟子程', T: "我知道了，李老师。我保证会刻板地平衡学习和羽毛球。绝不会让您担心。", R: '钟子程', L: '李洁', R_exp: 'default', L_exp: 'warm' },
            { S: '李洁', T: "（她的眼中有一丝不易察觉的失望，但很快恢复了严厉）嗯。记住你的承诺。你是较劲中学最有天赋的学生。不容许刻板的失误。", L_exp: 'strict', R: null },
            { T: "（我错过了机会。但她依然对我很好，只是那种微妙的情感，被压抑得更深了。）", S: '旁白', E: 'LJ_ROUTE_2_PRIVATE_STUDY' }
        ],
        LJ_ROUTE_1_C_RATIONALIZE: [
            { S: '钟子程', T: "李老师，您是不是在担心我因为学习压力太大而抑郁？请不要过度担忧。我会用我刻板的生物学知识，来调节我的情绪。", R: '钟子程', L: '李洁', R_exp: 'thought', L_exp: 'sad', Affinity: { Affection_LJ: -5 } },
            { S: '李洁', T: "（她无奈地摇了摇头，眼神中充满了复杂和失望）你总是这么…刻板。算了。我只是…在尽一个老师的本分。吃饭吧。", L_exp: 'sad', R: null },
            { T: "（我似乎说错了话。她那份难得流露出的情感，被我理性地推开了。我感觉，她离我更远了。）", S: '旁白', E: 'LJ_ROUTE_2_PRIVATE_STUDY' }
        ],
        LJ_ROUTE_2_PRIVATE_STUDY: [
            { B: 'office', T: "（我们的竞赛辅导仍在继续。李洁老师越来越喜欢在晚上，等其他老师都走光后，才开始我们的私密辅导。）", S: '旁白' },
            { L: '李洁', R: '钟子程', T: "子程，这道关于基因编辑的分析题，关键在于伦理和哲学的讨论。你只需要刻板地思考科学的边界即可。", S: '李洁', L_exp: 'thought', R_exp: 'thought' },
            { S: '钟子程', T: "李老师，我最近查阅了大量资料。发现生物学和哲学结合的领域非常有趣。您是如何平衡这两者的？", R: '钟子程', L: '李洁', L_exp: 'thought', R_exp: 'default' },
            { S: '李洁', T: "（她轻轻转动笔，眼神复杂）平衡？这个词太刻板了。很多时候，它们是矛盾的。就像…很多感情一样。科学需要理性，感情需要感性。你认为…哪一个更重要？", L: '李洁', L_exp: 'sad', R: '钟子程', R_exp: 'thought', Affinity: { Affection_LJ: 5 } },
            { T: "（她的问题，总是在不经意间触及我们关系的敏感地带。）", S: '钟子程', E: 'CHOICE_11_RATIONAL_OR_EMOTION' }
        ],
        CHOICE_11_RATIONAL_OR_EMOTION: {
            T: "（她问你理性和感性哪个更重要，这是对你情感倾向的试探。）",
            Choices: [
                { Text: "「在学术上，理性最重要；但在人生的路上，我希望能追随我的心。」（暗示情感）", Next: 'LJ_ROUTE_2_A_EMOTIONAL', Affinity: { Affection_LJ: 15 } },
                { Text: "「老师，当然是理性。我们是未来的科学家，必须保持刻板的理性。」（强化理性）", Next: 'LJ_ROUTE_2_B_RATIONAL', Affinity: { Affection_LJ: -5 } },
            ]
        },
        LJ_ROUTE_2_A_EMOTIONAL: [
            { S: '钟子程', T: "（我直视着她）李老师。在学术上，理性最重要；但在人生的路上，我希望能追随我的心。它指引我，走向那些…刻板的界限之外。", R: '钟子程', L: '李洁', R_exp: 'love', L_exp: 'blush' },
            { S: '李洁', T: "（她的呼吸变得急促，猛地收回了目光）刻板的界限…之外吗？钟子程，你…你太大胆了。这种想法…不符合…师生规范。", L_exp: 'strict', R: null, Affinity: { Affection_LJ: 10 } },
            { T: "（李老师的声音虽然严厉，但语气中却带着一丝无法掩饰的颤抖。我知道，我成功地打破了她内心的一部分防线。）", S: '旁白' },
            { S: '李洁', T: "（她站起身，走到窗边，背对着我）今天到此为止。你走吧。回去后，不要再思考这些刻板的…哲学问题。", L_exp: 'sad', R: null },
            { T: "（我没有离开，只是默默地收拾着桌子。我能感受到她背影中压抑的情感。）", S: '钟子程', E: 'LJ_ROUTE_2_CLOSURE' }
        ],
        LJ_ROUTE_2_B_RATIONAL: [
            { S: '钟子程', T: "老师，当然是理性。我们是未来的科学家，必须保持刻板的理性。感情是低效的变数。", R: '钟子程', L: '李洁', R_exp: 'thought', L_exp: 'sad', Affinity: { Affection_LJ: -5 } },
            { S: '李洁', T: "（她深深地叹了口气，眼中充满了失望）是啊。理性。你说的刻板正确。但…你难道不会觉得，这种绝对的理性，会让你失去一些…刻板的美好吗？", L: '李洁', L_exp: 'sad', R: null },
            { T: "（我不知道她说的‘美好’是什么。但看着她失落的表情，我的心底划过一丝不安。）", S: '旁白', E: 'LJ_ROUTE_2_CLOSURE' }
        ],
        LJ_ROUTE_2_CLOSURE: [
            { B: 'hallway', T: "（我走出办公室，看到李洁老师站在门口，似乎在等我。）", S: '旁白' },
            { L: '李洁', R: '钟子程', T: "子程。记住，这次竞赛对你来说，非常重要。这是你证明自己的机会。不要被任何…刻板的变数影响。", S: '李洁', L_exp: 'strict', R_exp: 'default' },
            { S: '钟子程', T: "李老师，我不会让您失望的。我一定会拿到一等奖，为您证明您的教导是最好的。", R: '钟子程', L: '李洁', L_exp: 'strict', R_exp: 'happy' },
            { S: '李洁', T: "（她突然向前走了一小步，轻轻地，像是整理我的衣领，指尖触碰到了我的皮肤。）我期待…你的成功。晚安。", L_exp: 'warm', R: null, Affinity: { Affection_LJ: 5 } },
            { T: "（那份轻微的触碰，让我全身的血液都沸腾了。这种介于师生和暧昧之间的关系，让我感到既刺激又痛苦。）", S: '钟子程', E: 'LJ_ROUTE_3_CLIMAX_PREP' }
        ],
        LJ_ROUTE_3_CLIMAX_PREP: [
            { B: 'classroom', T: "生物竞赛的日子到了。李洁老师是唯一的监考老师。考场里弥漫着只有我们两人能感受到的紧张氛围。", S: '旁白' },
            { L: '李洁', T: "（李洁老师站在讲台上，推了推眼镜）钟子程。请开始答题。记住，展现你所有的天赋。不要有任何刻板的保留。", S: '李洁', L_exp: 'strict', R: '钟子程', R_exp: 'thought' },
            { T: "竞赛过程出乎意料的顺利，我的生物天赋在李洁老师的指导下得到了完美的释放。最终，我顺利完成了答题。", S: '旁白' },
            { B: 'office', T: "一周后，李洁老师把我叫到办公室。我看到了那份一等奖的通知单。", S: '旁白' },
            { L: '李洁', R: '钟子程', T: "（李洁老师脸上露出了骄傲的笑容）钟子程，恭喜你。一等奖。这是你应得的刻板回报。你的未来，已经打开了无限可能。", S: '李洁', L_exp: 'warm', R_exp: 'happy', Affinity: { Affection_LJ: 10 } },
            { S: '钟子程', T: "谢谢李老师。这份荣誉，有您一半的功劳。是您的指导，让我突破了知识的刻板界限。", R: '钟子程', L: '李洁', L_exp: 'warm', R_exp: 'happy' },
            { S: '李洁', T: "（她突然收起了笑容，眼神变得严肃而复杂）钟子程。我有一个问题，你必须回答。关于你毕业后的规划…你想去哪里深造？", L_exp: 'thought', R: null },
            { S: '钟子程', T: "（我知道，现在是揭开谜底的时候了。她不再问我感性的问题，而是问我未来的规划。这才是她内心真正的界限。）", R: '钟子程', E: 'CHOICE_12_FINAL_DECISION' }
        ],
        CHOICE_12_FINAL_DECISION: {
            T: "（毕业后，你将选择继续深造生物，实现你和李洁老师的共同愿景吗？）",
            Choices: [
                { Text: "「我决定考入顶尖大学的生物系，并在毕业后回到较劲中学，成为您的同事。」（GE：承诺共同的未来）", Next: 'LJ_ROUTE_3_A_GE', Affinity: { Affection_LJ: 25 } },
                { Text: "「我想去海外深造，追求更前沿的生物学研究，不被任何刻板的关系束缚。」（BE：选择学术自由）", Next: 'LJ_ROUTE_3_B_BE', Affinity: { Affection_LJ: 5 } },
            ]
        },
        LJ_ROUTE_3_A_GE: [
            { B: 'office', T: "（李洁老师震惊地看着我，眼镜下的眼睛里充满了不可置信和巨大的喜悦。）", S: '旁白' },
            { S: '李洁', T: "（声音颤抖）你…你在说什么？回到较劲中学…成为我的…同事？你以为师生关系…是如此轻易能打破的吗？", L_exp: 'sad', R: null },
            { S: '钟子程', T: "（我走上前，握住了她放在桌上的手）师生关系，只存在于现在。未来，您是我的同事，更是我心之所向。您不是想让我突破刻板的界限吗？这就是我的突破。", R: '钟子程', L: '李洁', R_exp: 'love', L_exp: 'blush', Affinity: { Affection_LJ: 15 } },
            { S: '李洁', T: "（她轻轻地回握住我的手，眼中充满了泪水）你…你真是个笨蛋。我…我等这一天…等了太久了。", L_exp: 'love', R: null },
            { T: "（她站起来，轻轻地，将她的身体融入我的怀中。那份严厉和体贴，在这一刻达到了完美的平衡。）", S: '旁白' },
            { S: '李洁', T: "（低声）钟子程。请你…刻板地…快点长大。我不想再扮演你的老师了。", L_exp: 'love', R: null },
            { T: "后记：我考入国内顶尖大学，选择了生物系师范方向。在大学的四年里，我和李洁老师保持着秘密的恋情。四年后，我正式回到较劲中学，成为了一名生物老师，与李洁成为了办公室里最默契的同事。", S: '旁白', E: 'END_LJ' }
        ],
        LJ_ROUTE_3_B_BE: [
            { B: 'office', T: "（李洁老师静静地听完我的回答，脸上的笑容消失了。）", S: '旁白' },
            { S: '李洁', T: "（她推了推眼镜，眼神恢复了最初的严厉和冷漠）是吗。去海外深造。这是个…刻板的选择。那么，你将不再需要我这位…刻板的老师了。", L_exp: 'strict', R: null, Affinity: { Affection_LJ: -10 } },
            { S: '钟子程', T: "李老师…我…我依然会保持联系。您是我的导师！", R: '钟子程', L: '李洁', L_exp: 'strict', R_exp: 'shy' },
            { S: '李洁', T: "（她冷冷地笑了笑）导师？钟子程。导师是指导你未来方向的人，而不是…束缚你脚步的刻板。你选择了自由，就请你刻板地，独自前行吧。", L_exp: 'strict', R: null },
            { T: "李洁老师转过身，将那份一等奖的通知单放在桌上。我走出去，身后是她决绝的背影。那份隐藏在师生关系下的情感，最终被我的理性选择彻底扼杀。", S: '旁白' },
            { T: "后记：我去了海外，在生物研究领域取得了巨大成功。但我再也没有收到李洁老师的任何消息。那份师生间的禁忌之爱，成为了一个永远无法解开的函数。我获得了学术自由，却失去了那份刻板的温暖。", S: '旁白', E: 'END_LJ' }
        ],
        LJ_ROUTE_ENDING_CHECK: [
            { S: '旁白', T: "（好感度检查：李洁好感度：${Affection_LJ} / 100）", E: 'JUMP_TO_LJ_ENDING' }
        ],
        JUMP_TO_LJ_ENDING: {
            T: "跳转到李洁结局...",
            Choices: [
                { Text: "（好感度足够）进入 Good Ending", Next: 'LJ_ROUTE_3_A_GE', Condition: (gameState) => gameState.Affection_LJ >= 50 },
                { Text: "（好感度不足）进入 Bad Ending", Next: 'LJ_ROUTE_3_B_BE', Condition: (gameState) => gameState.Affection_LJ < 50 }
            ]
        },
        
        // --- 苏天佑线 结局 ---
        ST_ROUTE_ENDING_CHECK: [
            { S: '旁白', T: "（好感度检查：苏天佑好感度：${Affection_ST} / 100）", E: 'JUMP_TO_ST_ENDING' }
        ],
        JUMP_TO_ST_ENDING: {
            T: "跳转到苏天佑结局...",
            Choices: [
                { Text: "（好感度足够）进入 Good Ending", Next: 'ST_ROUTE_END_GE', Condition: (gameState) => gameState.Affection_ST >= 50 },
                { Text: "（好感度不足）进入 Friendship Ending", Next: 'ST_ROUTE_END_FE', Condition: (gameState) => gameState.Affection_ST < 50 }
            ]
        },
        ST_ROUTE_END_GE: [
            { B: 'street', T: "（夜晚，我们再次来到那片空地。今晚的星空，比任何时候都明亮。）", S: '旁白' },
            { L: '苏天佑', R: '钟子程', T: "子程。我们成功了。竞赛的胜利，是…是最好的证明。", S: '苏天佑', L_exp: 'happy', R_exp: 'love' },
            { S: '钟子程', T: "是的。但对我来说，能看到你再次露出这么开心的笑容，比任何奖杯都重要。", R: '钟子程', L: '苏天佑', L_exp: 'happy', R_exp: 'love' },
            { S: '苏天佑', T: "（她走近我，轻声说）你还记得，竞赛前夜我问你的问题吗？关于…不再是青梅竹马？", L: '苏天佑', L_exp: 'blush', R: '钟子程', R_exp: 'love' },
            { S: '钟子程', T: "当然。天佑，现在我们赢了。现在…我要正式告诉你我的‘最优解’。", R: '钟子程', L: '苏天佑', L_exp: 'blush', R_exp: 'love' },
            { T: "（我伸出手，轻轻地，将她的眼镜摘下。她的眼睛，清澈而深情。）", S: '旁白' },
            { S: '钟子程', T: "苏天佑。你不是我的妹妹，也不是我的搭档。你是…我最喜欢的女孩。我们在一起吧。", R: '钟子程', L: '苏天佑', L_exp: 'blush', R_exp: 'love', Affinity: { Affection_ST: 10 } },
            { S: '苏天佑', T: "（她的声音充满了压抑已久的甜蜜）嗯…刻板地来说，这是我人生中…最完美的证明题。我…永远不会放弃你，子程。", L: '苏天佑', R: '钟子程', R_exp: 'love', L_exp: 'blush' },
            { T: "我们紧紧相拥。高三的生活充满了挑战和压力，但我们找到了彼此的‘最优解’。", S: '旁白' },
            { T: "后记：毕业后，苏天佑在数学领域继续深造，而我则考入了国内顶尖大学的生物系。每到周末，我们都会相约在羽毛球馆。我们的爱情，如同她的数学证明一样，严谨而美丽，经久不衰。", S: '旁白', E: 'END_ST' }
        ],
        ST_ROUTE_END_FE: [
            { B: 'gym', T: "（生物竞赛结束后，我们在羽毛球馆庆祝。苏天佑看起来非常高兴，但那份兴奋中，似乎缺少了某种光芒。）", S: '旁白' },
            { L: '苏天佑', R: '钟子程', T: "（她发出了一个完美的扣杀，我反应不及，球落在界内）赢了！子程，我们配合得越来越默契了！", S: '苏天佑', L_exp: 'happy', R_exp: 'default' },
            { S: '钟子程', T: "是啊，天佑。和你一起打球，永远是最开心的事。我们的默契，是独一无二的。", R: '钟子程', L: '苏天佑', L_exp: 'happy', R_exp: 'happy' },
            { S: '苏天佑', T: "（她平静地看着我，眼神很深）独一无二的…兄妹情谊。是吧？", L: '苏天佑', R: '钟子程', R_exp: 'default', L_exp: 'calm' },
            { S: '钟子程', T: "（我的心头一紧，但还是故作轻松地笑了）当然了！我的好妹妹，今天赢球，我请你吃冰淇淋！", R: '钟子程', L: '苏天佑', L_exp: 'calm', R_exp: 'happy' },
            { T: "苏天佑没有再追问。她平静地笑了笑，接受了我的提议。从那一刻起，我们之间未曾宣之于口的感情，被我们共同埋藏，用‘青梅竹马’和‘兄妹’的刻板称呼，永远地保护了起来。", S: '旁白' },
            { T: "多年后，苏天佑凭借她杰出的数学天赋，考取了全国数学竞赛的金牌，并选择了深造数学。而我也成为了生物学界的翘楚。", S: '旁白' },
            { T: "我们依然是彼此最亲密的伙伴。在每一个关键时刻，我们都会出现在彼此的身边。但那份最初的心动，却成为了一个永远没有解开的方程，留在了高三的记忆中。", S: '旁白', E: 'END_ST' }
        ],
        RESTART_ROUTE_END: [
            { T: "游戏已结束。请刷新页面，重新开始游戏。" }
        ]
    };

    // --- 游戏逻辑函数 ---

    /**
     * 根据 key 设置背景样式和文字描述 (FIX: 使用 CSS 渐变)
     * @param {string} key 背景关键词
     */
    function setBackground(key) {
        const bg = GAME_CONFIG.BACKGROUND_MAP[key] || { background: 'linear-gradient(to bottom right, #161b22, #0d1117)', text: '场景转换' };
        background.style.background = bg.background;
        background.textContent = bg.text; // Display scene text
    }

    function setSprite(element, charName, expression = 'default', pos) {
        element.textContent = '';
        element.classList.remove('active');

        if (charName) {
            const char = GAME_CONFIG.SPRITE_MAP[charName];
            if (char) {
                setTimeout(() => {
                    element.textContent = char[expression] || char.default;
                    element.classList.add('active');
                }, 100);

                const otherElement = pos === 'left' ? spriteRight : spriteLeft;
                element.style.opacity = '1';
                element.style.filter = 'drop-shadow(0 4px 12px rgba(255, 255, 255, 0.4))'; 
                
                if (element.textContent) {
                    otherElement.style.opacity = '0.7';
                    otherElement.style.filter = 'drop-shadow(0 2px 5px rgba(0, 0, 0, 0.2)); filter: blur(1px)';
                }

            } else {
                console.warn(`角色 ${charName} 的Emoji未定义!`);
            }
        } else {
            element.textContent = '';
            element.classList.remove('active');
            if (!spriteLeft.textContent && !spriteRight.textContent) {
                 spriteLeft.style.opacity = '0';
                 spriteRight.style.opacity = '0';
                 spriteLeft.style.filter = 'none';
                 spriteRight.style.filter = 'none';
            }
        }
    }

    function typeText(fullText) {
        return new Promise(resolve => {
            if (gameState.isTyping) {
                textContent.innerHTML = fullText;
                gameState.isTyping = false;
                if (gameState.textQueue) clearTimeout(gameState.textQueue);
                resolve();
                return;
            }

            gameState.isTyping = true;
            textContent.innerHTML = '';
            let charIndex = 0;
            const typingSpeed = 30; // 毫秒

            function typeNextChar() {
                if (charIndex < fullText.length && gameState.isTyping) {
                    textContent.innerHTML += fullText[charIndex].replace(/\n/g, '<br>');
                    charIndex++;
                    gameState.textQueue = setTimeout(typeNextChar, typingSpeed);
                } else {
                    gameState.isTyping = false;
                    resolve();
                }
            }
            typeNextChar();
        });
    }

    async function startDialogue(step) {
        if (step.B) setBackground(step.B);
        if (step.L !== undefined) setSprite(spriteLeft, step.L, step.L_exp, 'left');
        if (step.R !== undefined) setSprite(spriteRight, step.R, step.R_exp, 'right');

        if (step.S) {
            nameBox.textContent = step.S;
        } else {
            nameBox.textContent = '旁白';
            if (step.L === undefined && step.R === undefined) {
                 spriteLeft.style.opacity = '0';
                 spriteRight.style.opacity = '0';
            }
        }

        dialogueBox.removeEventListener('click', nextStepHandler);
        let textToShow = step.T.replace(/\$\{(\w+)\}/g, (match, key) => gameState[key] || match);
        await typeText(textToShow);

        if (!step.E || step.E === 'NEXT') {
            dialogueBox.addEventListener('click', nextStepHandler);
        }
    }

    function handleEvent(step) {
        if (!step.E) return;

        switch (step.E) {
            case 'NEXT':
                gameState.index++;
                playScene(gameState.scene);
                break;
            case 'START_GAME': 
                gameState.index = 0;
                gameState.scene = 'C1_INTRO';
                playScene('C1_INTRO');
                break;
            case 'CHOICE_1':
            case 'CHOICE_2':
            case 'CHOICE_3':
            case 'CHOICE_4':
            case 'CHOICE_5_ROUTE_SPLIT':
            case 'CHOICE_6':
            case 'CHOICE_7':
            case 'WZ_ROUTE_1_CHOICE_BADMINTON':
            case 'CHOICE_8_FUTURE_PLAN':
            case 'CHOICE_9_CONFESSION':
            case 'CHOICE_10_RELATIONSHIP_HINT':
            case 'CHOICE_11_RATIONAL_OR_EMOTION':
            case 'CHOICE_12_FINAL_DECISION':
                showChoices(story[step.E]);
                break;
            case 'C1_END':
                gameState.index = 0;
                gameState.scene = 'C1_END';
                playScene('C1_END');
                break;
            case 'JUMP_TO_ST_ENDING':
                // ST线结局检查
                const geChoice_ST = story.JUMP_TO_ST_ENDING.Choices.find(c => c.Condition && c.Condition(gameState));
                const feChoice_ST = story.JUMP_TO_ST_ENDING.Choices.find(c => !c.Condition || !c.Condition(gameState));
                if (geChoice_ST && geChoice_ST.Condition(gameState)) {
                    gameState.index = 0;
                    gameState.scene = geChoice_ST.Next;
                    playScene(geChoice_ST.Next);
                } else if (feChoice_ST) {
                    gameState.index = 0;
                    gameState.scene = feChoice_ST.Next;
                    playScene(feChoice_ST.Next);
                } else {
                    handleEvent({ E: 'RESTART' });
                }
                break;
            case 'JUMP_TO_WZ_ENDING':
                // WZ线结局检查
                const geChoice_WZ = story.JUMP_TO_WZ_ENDING.Choices.find(c => c.Condition && c.Condition(gameState));
                const beChoice_WZ = story.JUMP_TO_WZ_ENDING.Choices.find(c => !c.Condition || !c.Condition(gameState));
                if (geChoice_WZ && geChoice_WZ.Condition(gameState)) {
                    gameState.index = 0;
                    gameState.scene = geChoice_WZ.Next;
                    playScene(geChoice_WZ.Next);
                } else if (beChoice_WZ) {
                    gameState.index = 0;
                    gameState.scene = beChoice_WZ.Next;
                    playScene(beChoice_WZ.Next);
                } else {
                    handleEvent({ E: 'RESTART' });
                }
                break;
            case 'JUMP_TO_LJ_ENDING':
                // LJ线结局检查
                const geChoice_LJ = story.JUMP_TO_LJ_ENDING.Choices.find(c => c.Condition && c.Condition(gameState));
                const beChoice_LJ = story.JUMP_TO_LJ_ENDING.Choices.find(c => !c.Condition || !c.Condition(gameState));
                if (geChoice_LJ && geChoice_LJ.Condition(gameState)) {
                    gameState.index = 0;
                    gameState.scene = geChoice_LJ.Next;
                    playScene(geChoice_LJ.Next);
                } else if (beChoice_LJ) {
                    gameState.index = 0;
                    gameState.scene = beChoice_LJ.Next;
                    playScene(beChoice_LJ.Next);
                } else {
                    handleEvent({ E: 'RESTART' });
                }
                break;
            case 'RESTART':
                // 重置游戏
                gameState.index = 0;
                gameState.scene = 'START';
                updateDebugInfo();
                showEndScreen('游戏重置', '游戏状态已清除。', true);
                break;
            case 'END_ST':
            case 'END_WZ':
            case 'END_LJ':
            case 'END':
                showEndScreen(`【${step.E.replace('END_', '')} 线 完】`, story[step.E].at(-1).T);
                break;
            default:
                if (story[step.E]) {
                    gameState.index = 0;
                    gameState.scene = step.E;
                    playScene(step.E);
                } else {
                    console.error(`未找到场景: ${step.E}`);
                    handleEvent({ E: 'RESTART' });
                }
                break;
        }
    }

    function playScene(sceneName) {
        const scene = story[sceneName];
        const step = scene[gameState.index];

        if (!step) {
            // 当场景结束时，检查是否需要跳转到结局检查点
            if (sceneName.startsWith('ST_ROUTE_4_RESULT')) {
                 handleEvent({ E: 'ST_ROUTE_ENDING_CHECK' });
                 return;
            } else if (sceneName.startsWith('WZ_ROUTE_3_FINAL_CONFRONTATION')) {
                 handleEvent({ E: 'WZ_ROUTE_ENDING_CHECK' });
                 return;
            } else if (sceneName.startsWith('LJ_ROUTE_3_CLIMAX_PREP')) {
                 handleEvent({ E: 'LJ_ROUTE_ENDING_CHECK' });
                 return;
            }
            
            handleEvent({ E: 'RESTART' }); // 确保场景结束时不会崩溃
            return;
        }

        if (step.Affinity) {
            for (const char in step.Affinity) {
                gameState[char] += step.Affinity[char];
            }
            updateDebugInfo();
        }

        if (typeof scene.Choices !== 'undefined' || step.T === undefined) {
             handleEvent({ E: sceneName });
             return;
        }

        if (step.E && step.E !== 'NEXT') {
            startDialogue(step).then(() => {
                handleEvent(step);
            });
        } else {
            startDialogue(step);
        }
    }

    /**
     * 根据 key 设置背景样式和文字描述 (FIX: 使用 CSS 渐变)
     * @param {string} key 背景关键词
     */
    function setBackground(key) {
        const bg = GAME_CONFIG.BACKGROUND_MAP[key] || { background: 'linear-gradient(to bottom right, #161b22, #0d1117)', text: '场景转换' };
        background.style.background = bg.background;
        background.textContent = bg.text; // Display scene text
    }

    function showChoices(choiceScene) {
        dialogueBox.classList.add('hidden');
        choicesContainer.classList.remove('hidden');
        choicesContainer.classList.add('p-8', 'bg-gray-900/90', 'rounded-xl', 'text-center');

        choicesContainer.innerHTML = `<h3 class="text-xl text-white font-bold mb-4">${choiceScene.T}</h3>`;

        choiceScene.Choices.forEach((choice, index) => {
            if (choiceScene.E.startsWith('JUMP_TO_')) return; 

            const button = document.createElement('button');
            button.className = 'choice-button';
            button.textContent = `${index + 1}. ${choice.Text}`;
            button.onclick = () => {
                handleChoice(choice);
            };
            choicesContainer.appendChild(button);
        });
    }

    function handleChoice(choice) {
        choicesContainer.classList.add('hidden');
        choicesContainer.innerHTML = '';
        choicesContainer.classList.remove('p-8', 'bg-gray-900/90', 'rounded-xl', 'text-center');

        dialogueBox.classList.remove('hidden');

        if (choice.Affinity) {
            for (const char in choice.Affinity) {
                gameState[char] += choice.Affinity[char];
            }
            updateDebugInfo();
        }

        if (choice.Next) {
            gameState.index = 0;
            gameState.scene = choice.Next;
            playScene(choice.Next);
        }
    }

    // FIX: 结局界面显示逻辑
    function showEndScreen(title, message, isResetPrompt = false) {
        dialogueBox.classList.add('hidden');
        choicesContainer.classList.remove('hidden');
        choicesContainer.classList.add('p-8', 'bg-gray-900/90', 'rounded-xl', 'text-center');
        
        // Hide sprites when game ends
        setSprite(spriteLeft, null);
        setSprite(spriteRight, null);
        
        // Use a generic final scene background
        setBackground('rooftop'); 
        background.textContent = title;

        choicesContainer.innerHTML = `
            <h3 class="text-3xl text-red-400 font-extrabold mb-4">${title}</h3>
            <p class="text-lg text-gray-200 mb-6 text-left whitespace-pre-wrap">${message.replace(/\n/g, '<br>')}</p>
            <button id="restart-button" class="choice-button bg-pink-600 hover:bg-pink-700 w-full mx-auto mt-4">
                点击重新开始游戏 (刷新页面)
            </button>
        `;
        
        document.getElementById('restart-button').onclick = () => {
            window.location.reload(); 
        };
    }

    function updateDebugInfo() {
        debugInfo.innerHTML = `
            场景: ${gameState.scene} | 步骤: ${gameState.index}<br>
            王子豪好感度: ${gameState.Affection_WZ} / 100<br>
            苏天佑好感度: ${gameState.Affection_ST} / 100<br>
            李洁好感度: ${gameState.Affection_LJ} / 100
        `;
    }

    function nextStepHandler() {
        if (!gameState.isTyping) {
            gameState.index++;
            playScene(gameState.scene);
        } else {
            typeText(textContent.innerHTML);
        }
    }

    function initializeGame() {
        updateDebugInfo();
        dialogueBox.addEventListener('click', nextStepHandler);
        playScene('START');
    }

    window.onload = initializeGame;

</script>

</body>
</html>
